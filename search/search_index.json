{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"index.html","title":"Accueil","text":"<p>INTRODUCTION AU  LANGAGE VBSCRIPT</p> <p>Serge Tah\u00e9, janvier 2002</p>"},{"location":"introduction.html","title":"1. Introduction","text":"<p>Ce document a pour but de fournir les bases du langage vbscript ainsi que des exemples d'utilisation dans diff\u00e9rents domaines. VBScript est un langage de script sous Windows. Il peut fonctionner dans diff\u00e9rents conteneurs tels</p> <ul> <li>Windows Scripting Host pour une utilisation directe sous Windows notamment pour \u00e9crire des scripts d'administration syst\u00e8me</li> <li>Internet Explorer. Il est alors utilis\u00e9 au sein de pages HTML auxquelles il am\u00e8ne une certaine interactivit\u00e9 impossible \u00e0 atteindre avec le seul langage HTML.</li> <li>Internet Information Server (IIS) le serveur Web de Microsoft sur NT/2000 et son \u00e9quivalent Personal Web Server (PWS) sur Win9x. Dans ce cas, vbscript est utilis\u00e9 pour faire de la programmation c\u00f4t\u00e9 serveur web, technologie appel\u00e9e ASP (Active Server Pages) par Microsoft. Par ailleurs, VBSCRIPT \u00e9tant un langage d\u00e9riv\u00e9 de Visual Basic pour Windows, il peut servir d'introduction \u00e0 ce langage parmi les plus r\u00e9pandus dans le domaine Windows ainsi qu'\u00e0 la version Application de VB, appel\u00e9e VBA (Visual Basic pour Applications). VBA est utilis\u00e9 par exemple dans tout la suite Office de Microsoft notamment dans Excel. Ainsi VBSCRIPT est une voie d'entr\u00e9e au d\u00e9veloppement dans un vaste domaine d'applications windows.</li> </ul> <p>VBScript n'est pas un langage \u00e0 objets m\u00eame s'il en a une certaine coloration. La notion d'h\u00e9ritage, par exemple, n'existe pas. Il peut cependant utiliser les objets mis \u00e0 sa disposition par le conteneur dans lequel il s'ex\u00e9cute ainsi que plus g\u00e9n\u00e9ralement les composants ActiveX disponibles sur la machine Windows. C'est cet aspect qui donne sa puissance \u00e0 VBScript, langage qui intrins\u00e8quement est assez pauvre mais qui gr\u00e2ce aux objets mis \u00e0 sa disposition peut rivaliser avec des langages de script au d\u00e9part plus riches tels Perl, Javascript, Python. C'est un langage simple \u00e0 apprendre, \u00e0 utiliser et qui ouvre la voie \u00e0 l'utilisation de Visual Basic pour Windows dont il est directement d\u00e9riv\u00e9.</p> <p>Ce document n'est pas un cours d'algorithmique. L'art de la programmation est suppos\u00e9 acquis. Un travail de lecture actif est n\u00e9cessaire. La meilleure fa\u00e7on d'utiliser ce document est probablement de tester sur sa propre machine les exemples qui y sont donn\u00e9s. Le conteneur WSH est normalement livr\u00e9 en standard avec le syst\u00e8me Windows. La version la plus r\u00e9cente est disponible gratuitement sur le site de Microsoft (http://www.microsoft.com). Pour trouver l'URL exacte permettant le t\u00e9l\u00e9chargement de WSH, on pourra chercher les mots cl\u00e9s \"Windows Scripting\" avec un moteur de recherche sur le Web. Parmi les r\u00e9ponses, on devrait trouver l'URL de t\u00e9l\u00e9chargement de WSH.</p> <p>Serge Tah\u00e9, janvier 2002</p>"},{"location":"la-gestion-des-erreurs.html","title":"4. La gestion des erreurs","text":"<p>En programmation, il y a une r\u00e8gle absolue : un programme ne doit jamais \"planter\" sauvagement. Toutes les erreurs qui peuvent se produire lors de l'ex\u00e9cution du programme doivent \u00eatre g\u00e9r\u00e9es et des messages d'erreurs significatifs g\u00e9n\u00e9r\u00e9s.</p> <p>Si nous reprenons l'exemple des imp\u00f4ts trait\u00e9 pr\u00e9c\u00e9demment, que se passe-t-il si l'utilisateur entre n'importe quoi pour le nombre d'enfants. Regardons sur cet exemple :</p> <pre><code>C:\\&gt;cscript impots1.vbs o xyzt 200000\n\nC:\\impots1.vbs(33, 3) Erreur d'ex\u00e9cution Microsoft VBScript: Type incompatible: 'cint'\n</code></pre> <p>C'est ce qu'on appelle un plantage sauvage. Il y a eu \"plantage\" sur l'instruction  enfants=cint(wscript.arguments(1)) car arguments(1) contenait la cha\u00eene \"xyzt\".</p> <p>Avant d'utiliser un variant dont on ne conna\u00eet pas la nature exacte, il faut v\u00e9rifier son sous-type exact. On peut faire ceci de diff\u00e9rentes fa\u00e7ons :</p> <ul> <li>tester le type r\u00e9el de la donn\u00e9e contenue dans un variant avec les fonctions vartype ou typename</li> <li>utiliser une expression r\u00e9guli\u00e8re pour v\u00e9rifier que le contenu du variant correspond \u00e0 un certain mod\u00e8le</li> <li>laisser l'erreur se produire puis l'intercepter pour ensuite la g\u00e9rer Nous examinons ces diff\u00e9rentes m\u00e9thodes.</li> </ul>"},{"location":"la-gestion-des-erreurs.html#41-connaitre-le-type-exact-dune-donnee","title":"4.1. Conna\u00eetre le type exact d'une donn\u00e9e","text":"<p>Rappelons que les fonctions vartype ou varname permettent de conna\u00eetre le type exact d'une donn\u00e9e. Cela ne nous est pas toujours d'un grand secours. Par exemple, lorsque nous lisons une donn\u00e9e tap\u00e9e au clavier, les fonctions vartype et typename vont nous dire que c'est une cha\u00eene de caract\u00e8res car c'est ainsi qu'est consid\u00e9r\u00e9e toute donn\u00e9e tap\u00e9e au clavier. Cela ne nous dit pas si cette cha\u00eene peut par exemple \u00eatre consid\u00e9r\u00e9e comme un nombre valide. On utilise alors d'autres fonctions pour avoir acc\u00e8s \u00e0 ce type d'informations :</p> <p>isNumeric(expression)</p><p>rend vrai si expression peut \u00eatre utilis\u00e9e comme un nombre</p><p>isDate(expression)</p><p>rend vrai si expression peut \u00eatre utilis\u00e9e comme une date</p><p>isEmpty(var)</p><p>rend vrai si la variable var n'a pas \u00e9t\u00e9 initialis\u00e9e</p><p>isNull(var)</p><p>rend vrai si la variable var contient des donn\u00e9es invalides</p><p>isArray(var)</p><p>rend vrai si var est un tableau</p><p>isObject(var)</p><p>rend vrai si var est un objet</p> <p>L'exemple suivant demande de taper une donn\u00e9e au clavier jusqu'\u00e0 ce que celle-ci soit reconnue comme un nombre :</p> <p>Programme</p> <pre><code>' lecture d'une donn\u00e9e jusqu'\u00e0 ce que celle-ci soit reconnue comme un nombre\n\nOption Explicit\n\nDim fini, nombre\n\n' on boucle tant que la donn\u00e9e saisie n'est pas correcte\n' la boucle est contr\u00f4l\u00e9e par un bool\u00e9en fini, mis \u00e0 faux au d\u00e9part (= ce n'est pas fini)\n\nfini=false\nDo While Not fini\n' on demande le nombre\nwscript.stdout.write \"Tapez un nombre : \"\n' on le lit\nnombre=wscript.stdin.readLine\n' le type est forc\u00e9ment string lors d'une lecture\nwscript.echo \"Type de la donn\u00e9e lue : \" &amp; typename(nombre) &amp; \",\" &amp; vartype(nombre)\n' on teste le type r\u00e9el de la donn\u00e9e lue\nIf isNumeric(nombre) Then \nfini=true\nElse\nwscript.echo \"Erreur, vous n'avez pas tap\u00e9 un nombre. Recommencez svp...\"\nEnd If\nLoop\n\n' confirmation\nwscript.echo \"Merci pour le nombre \" &amp; nombre\n\n' et fin\nwscript.quit 0\n</code></pre> <p>R\u00e9sultats</p> <pre><code>Tapez un nombre : a\nType de la donn\u00e9e lue : String,8\nErreur, vous n'avez pas tap\u00e9 un nombre. Recommencez svp...\nTapez un nombre : -12\nType de la donn\u00e9e lue : String,8\nMerci pour le nombre -12\n</code></pre> <p>La fonction isNumeric ne nous dit pas si une expression est un entier ou pas. Pour avoir cette information, il faut faire des tests suppl\u00e9mentaires. L'exemple suivant demande un nombre entier &gt;0 :</p> <p>Programme</p> <pre><code>' lecture d'une donn\u00e9e jusqu'\u00e0 ce que celle-ci soit reconnue comme un nombre entier &gt;0\n\nOption Explicit\n\nDim fini, nombre\n\n' on boucle tant que la donn\u00e9e saisie n'est pas correcte\n' la boucle est contr\u00f4l\u00e9e par un bool\u00e9en fini, mis \u00e0 faux au d\u00e9part (= ce n'est pas fini)\n\nfini=false\nDo While Not fini\n' on demande le nombre\nwscript.stdout.write \"Tapez un nombre entier &gt;0: \"\n' on le lit\nnombre=wscript.stdin.readLine\n' on teste le type r\u00e9el de la donn\u00e9e lue\nIf isNumeric(nombre) Then\n' est-ce un entier (nombre \u00e9gal \u00e0 sa partie enti\u00e8re) positif ?\nIf (nombre-int(nombre))=0 And nombre&gt;0 Then\nfini=true\nEnd If\nEnd If\n' msg d'erreur \u00e9ventuel\nIf Not fini Then wscript.echo \"Erreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\"\nLoop\n\n' confirmation\nwscript.echo \"Merci pour le nombre entier &gt;0 : \" &amp; nombre\n\n' et fin\nwscript.quit 0\n</code></pre> <p>R\u00e9sultats</p> <pre><code>Tapez un nombre entier &gt;0: a\nErreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\nTapez un nombre entier &gt;0: -1\nErreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\nTapez un nombre entier &gt;0: 10.6\nErreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\nTapez un nombre entier &gt;0: 12\nMerci pour le nombre entier &gt;0 : 12\n</code></pre> <p>Commentaires :</p> <ul> <li>int(nombre) donne la partie enti\u00e8re d'un nombre. Un nombre \u00e9gal \u00e0 sa partie enti\u00e8re est un entier.</li> <li>On notera, de fa\u00e7on int\u00e9ressante, qu'il a fallu employer le test If (nombre-int(nombre))=0 And nombre&gt;0  parce que le test If nombre=int(nombre) And nombre&gt;0 ne donnait pas les r\u00e9sultats escompt\u00e9s. Il ne d\u00e9tectait pas les nombres entiers positifs. Nous laissons au lecteur le soin de d\u00e9couvrir pourquoi.</li> <li>Le test If (nombre-int(nombre))=0 n'est pas totalement fiable. Regardons l'exemple d'ex\u00e9cution suivant :</li> </ul> <pre><code>Tapez un nombre entier &gt;0: 4,0000000000000000000000001\n\nMerci pour le nombre entier &gt;0 : 4,0000000000000000000000001\n</code></pre> <p>Les nombres r\u00e9els ne sont pas repr\u00e9sent\u00e9s de fa\u00e7on exacte mais de fa\u00e7on approch\u00e9e. Et ici, l'op\u00e9ration nombre-int(nombre) a donn\u00e9 0 \u00e0 la pr\u00e9cision pr\u00e8s de l'ordinateur.</p>"},{"location":"la-gestion-des-erreurs.html#42-les-expressions-regulieres","title":"4.2. Les expressions r\u00e9guli\u00e8res","text":"<p>Les expressions r\u00e9guli\u00e8res nous permettent de tester le format d'une cha\u00eene de caract\u00e8res. Ainsi on peut v\u00e9rifier qu'une cha\u00eene repr\u00e9sentant une date est au format jj/mm/aa. On utilise pour cela un mod\u00e8le et on compare la cha\u00eene \u00e0 ce mod\u00e8le. Ainsi dans cet exemple, j m et a doivent \u00eatre des chiffres. Le mod\u00e8le d'un format de date valide est alors \"\\d\\d/\\d\\d/\\d\\d\" o\u00f9 le symbole \\d d\u00e9signe un chiffre. Les symboles utilisables dans un mod\u00e8le sont les suivants (documentation Microsoft) :</p> <p>Caract\u00e8re</p><p>Description</p><p>\\ </p><p>Marque le caract\u00e8re suivant comme caract\u00e8re sp\u00e9cial ou litt\u00e9ral. Par exemple, \"n\" correspond au caract\u00e8re \"n\". \"\\n\" correspond \u00e0 un caract\u00e8re de nouvelle ligne. La s\u00e9quence \"\\\\\" correspond \u00e0 \"\\\", tandis que \"\\(\" correspond \u00e0 \"(\".</p><p>^ </p><p>Correspond au d\u00e9but de la saisie.</p><p>$ </p><p>Correspond \u00e0 la fin de la saisie.</p><p>* </p><p>Correspond au caract\u00e8re pr\u00e9c\u00e9dent z\u00e9ro fois ou plusieurs fois. Ainsi, \"zo*\" correspond \u00e0 \"z\" ou \u00e0 \"zoo\".</p><p>+ </p><p>Correspond au caract\u00e8re pr\u00e9c\u00e9dent une ou plusieurs fois. Ainsi, \"zo+\" correspond \u00e0 \"zoo\", mais pas \u00e0 \"z\".</p><p>? </p><p>Correspond au caract\u00e8re pr\u00e9c\u00e9dent z\u00e9ro ou une fois. Par exemple, \"a?ve?\" correspond \u00e0 \"ve\" dans \"lever\".</p><p>.</p><p>Correspond \u00e0 tout caract\u00e8re unique, sauf le caract\u00e8re de nouvelle ligne.</p><p>(mod\u00e8le) </p><p>Recherche le mod\u00e8le et m\u00e9morise la correspondance. La sous-cha\u00eene correspondante peut \u00eatre extraite de la collection Matches obtenue, \u00e0 l'aide d'Item [0]...[n]. Pour trouver des correspondances avec des caract\u00e8res entre parenth\u00e8ses ( ), utilisez \"\\(\" ou \"\\)\".</p><p>x|y</p><p>Correspond soit \u00e0 x soit \u00e0 y. Par exemple, \"z|foot\" correspond \u00e0 \"z\" ou \u00e0 \"foot\". \"(z|f)oo\" correspond \u00e0 \"zoo\" ou \u00e0 \"foo\".</p><p>{n}</p><p>n est un nombre entier non n\u00e9gatif. Correspond exactement \u00e0 n fois le caract\u00e8re. Par exemple, \"o{2}\" ne correspond pas \u00e0 \"o\" dans \"Bob,\" mais aux deux premiers \"o\" dans \"fooooot\".</p><p>{n,} </p><p>n est un entier non n\u00e9gatif. Correspond \u00e0 au moins n fois le caract\u00e8re. Par exemple, \"o{2,}\" ne correspond pas \u00e0 \"o\" dans \"Bob\", mais \u00e0 tous les \"o\" dans \"fooooot\". \"o{1,}\" \u00e9quivaut \u00e0 \"o+\" et \"o{0,}\" \u00e9quivaut \u00e0 \"o*\".</p><p>{n,m} </p><p>m et n sont des entiers non n\u00e9gatifs. Correspond \u00e0 au moins n et \u00e0 au plus m fois le caract\u00e8re. Par exemple, \"o{1,3}\" correspond aux trois premiers \"o\" dans \"foooooot\" et \"o{0,1}\" \u00e9quivaut \u00e0 \"o?\".</p><p>[xyz] </p><p>Jeu de caract\u00e8res. Correspond \u00e0 l'un des caract\u00e8res indiqu\u00e9s. Par exemple, \"[abc]\" correspond \u00e0 \"a\" dans \"plat\". </p><p>[^xyz] </p><p>Jeu de caract\u00e8res n\u00e9gatif. Correspond \u00e0 tout caract\u00e8re non indiqu\u00e9. Par exemple, \"[^abc]\" correspond \u00e0 \"p\" dans \"plat\". </p><p>[a-z] </p><p>Plage de caract\u00e8res. Correspond \u00e0 tout caract\u00e8re dans la s\u00e9rie sp\u00e9cifi\u00e9e. Par exemple, \"[a-z]\" correspond \u00e0 tout caract\u00e8re alphab\u00e9tique minuscule compris entre \"a\" et \"z\". </p><p>[^m-z] </p><p>Plage de caract\u00e8res n\u00e9gative. Correspond \u00e0 tout caract\u00e8re ne se trouvant pas dans la s\u00e9rie sp\u00e9cifi\u00e9e. Par exemple, \"[^m-z]\" correspond \u00e0 tout caract\u00e8re ne se trouvant pas entre \"m\" et \"z\". </p><p>\\b </p><p>Correspond \u00e0 une limite repr\u00e9sentant un mot, autrement dit, \u00e0 la position entre un mot et un espace. Par exemple, \"er\\b\" correspond \u00e0 \"er\" dans \"lever\", mais pas \u00e0 \"er\" dans \"verbe\".</p><p>\\B </p><p>Correspond \u00e0 une limite ne repr\u00e9sentant pas un mot. \"en*t\\B\" correspond \u00e0 \"ent\" dans \"bien entendu\". </p><p>\\d </p><p>Correspond \u00e0 un caract\u00e8re repr\u00e9sentant un chiffre. \u00c9quivaut \u00e0 [0-9]. </p><p>\\D </p><p>Correspond \u00e0 un caract\u00e8re ne repr\u00e9sentant pas un chiffre. \u00c9quivaut \u00e0 [^0-9].</p><p>\\f </p><p>Correspond \u00e0 un caract\u00e8re de saut de page.</p><p>\\n </p><p>Correspond \u00e0 un caract\u00e8re de nouvelle ligne. </p><p>\\r </p><p>Correspond \u00e0 un caract\u00e8re de retour chariot. </p><p>\\s </p><p>Correspond \u00e0 tout espace blanc, y compris l'espace, la tabulation, le saut de page, etc. \u00c9quivaut \u00e0 \"[\u00a0\\f\\n\\r\\t\\v]\".</p><p>\\S </p><p>Correspond \u00e0 tout caract\u00e8re d'espace non blanc. \u00c9quivaut \u00e0 \"[^\u00a0\\f\\n\\r\\t\\v]\". </p><p>\\t </p><p>Correspond \u00e0 un caract\u00e8re de tabulation. </p><p>\\v </p><p>Correspond \u00e0 un caract\u00e8re de tabulation verticale. </p><p>\\w </p><p>Correspond \u00e0 tout caract\u00e8re repr\u00e9sentant un mot et incluant un trait de soulignement. \u00c9quivaut \u00e0 \"[A-Za-z0-9_]\". </p><p>\\W </p><p>Correspond \u00e0 tout caract\u00e8re ne repr\u00e9sentant pas un mot. \u00c9quivaut \u00e0 \"[^A-Za-z0-9_]\". </p><p>\\num </p><p>Correspond \u00e0 num, o\u00f9 num est un entier positif. Fait r\u00e9f\u00e9rence aux correspondances m\u00e9moris\u00e9es. Par exemple, \"(.)\\1\" correspond \u00e0 deux caract\u00e8res identiques cons\u00e9cutifs. </p><p>\\n</p><p>Correspond \u00e0 n, o\u00f9 n est une valeur d'\u00e9chappement octale. Les valeurs d'\u00e9chappement octales doivent comprendre 1, 2 ou 3 chiffres. Par exemple, \"\\11\" et \"\\011\" correspondent tous les deux \u00e0 un caract\u00e8re de tabulation. \"\\0011\" \u00e9quivaut \u00e0 \"\\001\" &amp; \"1\". Les valeurs d'\u00e9chappement octales ne doivent pas exc\u00e9der 256. Si c'\u00e9tait le cas, seuls les deux premiers chiffres seraient pris en compte dans l'expression. Permet d'utiliser les codes ASCII dans des expressions r\u00e9guli\u00e8res.</p><p>\\xn</p><p>Correspond \u00e0 n, o\u00f9 n est une valeur d'\u00e9chappement hexad\u00e9cimale. Les valeurs d'\u00e9chappement hexad\u00e9cimales doivent comprendre deux chiffres obligatoirement. Par exemple, \"\\x41\" correspond \u00e0 \"A\". \"\\x041\" \u00e9quivaut \u00e0 \"\\x04\" &amp; \"1\". Permet d'utiliser les codes ASCII dans des expressions r\u00e9guli\u00e8res.</p> <p>Un \u00e9l\u00e9ment dans un mod\u00e8le peut \u00eatre pr\u00e9sent en 1 ou plusieurs exemplaires. Consid\u00e9rons quelques exemples autour du symbole \\d qui repr\u00e9sente 1 chiffre :</p> <p>mod\u00e8le</p><p>signification</p><p>\\d</p><p>un chiffre</p><p>\\d?</p><p>0 ou 1 chiffre</p><p>\\d*</p><p>0 ou davantage de chiffres</p><p>\\d+</p><p>1 ou davantage de chiffres</p><p>\\d{2}</p><p>2 chiffres</p><p>\\d{3,}</p><p>au moins 3 chiffres</p><p>\\d{5,7}</p><p>entre 5 et 7 chiffres</p> <p>Imaginons maintenant le mod\u00e8le capable de d\u00e9crire le format attendu pour une cha\u00eene de caract\u00e8res :</p> <p>cha\u00eene recherch\u00e9e</p><p>mod\u00e8le</p><p>une date au format jj/mm/aa</p><p>\\d{2}/\\d{2}/\\d{2}</p><p>une heure au format hh:mm:ss</p><p>\\d{2}:\\d{2}:\\d{2}</p><p>un nombre entier non sign\u00e9</p><p>\\d+</p><p>un suite d'espaces \u00e9ventuellement vide</p><p>\\s*</p><p>un nombre entier non sign\u00e9 qui peut \u00eatre pr\u00e9c\u00e9d\u00e9 ou suivi d'espaces</p><p>\\s*\\d+\\s*</p><p>un nombre entier qui peut \u00eatre sign\u00e9 et pr\u00e9c\u00e9d\u00e9 ou suivi d'espaces</p><p>\\s*[+|-]?\\s*\\d+\\s*</p><p>un nombre r\u00e9el non sign\u00e9 qui peut \u00eatre pr\u00e9c\u00e9d\u00e9 ou suivi d'espaces</p><p>\\s*\\d+(.\\d*)?\\s*</p><p>un nombre r\u00e9el qui peut \u00eatre sign\u00e9 et pr\u00e9c\u00e9d\u00e9 ou suivi d'espaces</p><p>\\s*[+|]?\\s*\\d+(.\\d*)?\\s*</p><p>une cha\u00eene contenant le mot juste</p><p>\\bjuste\\b</p> <p>On peut pr\u00e9ciser o\u00f9 on recherche le mod\u00e8le dans la cha\u00eene :</p> <p>mod\u00e8le</p><p>signification</p><p>^mod\u00e8le</p><p>le mod\u00e8le commence la cha\u00eene</p><p>mod\u00e8le$</p><p>le mod\u00e8le finit la cha\u00eene</p><p>^mod\u00e8le$</p><p>le mod\u00e8le commence et finit la cha\u00eene</p><p>mod\u00e8le</p><p>le mod\u00e8le est cherch\u00e9 partout dans la cha\u00eene en commen\u00e7ant par le d\u00e9but de celle-ci.</p> <p>cha\u00eene recherch\u00e9e</p><p>mod\u00e8le</p><p>une cha\u00eene se terminant par un point d'exclamation</p><p>!$</p><p>une cha\u00eene se terminant par un point</p><p>\\.$</p><p>une cha\u00eene commen\u00e7ant par la s\u00e9quence //</p><p>^//</p><p>une cha\u00eene ne comportant qu'un mot \u00e9ventuellement suivi ou pr\u00e9c\u00e9d\u00e9 d'espaces</p><p>^\\s*\\w+\\s*$</p><p>une cha\u00eene ne comportant deux mot \u00e9ventuellement suivis ou pr\u00e9c\u00e9d\u00e9s d'espaces</p><p>^\\s*\\w+\\s*\\w+\\s*$</p><p>une cha\u00eene contenant le mot secret</p><p>\\bsecret\\b</p> <p>Les sous-ensembles d'un mod\u00e8le peuvent \u00eatre \"r\u00e9cup\u00e9r\u00e9s\". Ainsi non seulement, on peut v\u00e9rifier qu'une cha\u00eene correspond \u00e0 un mod\u00e8le particulier mais on peut r\u00e9cup\u00e9rer dans cette cha\u00eene les \u00e9l\u00e9ments correspondant aux sous-ensembles du mod\u00e8le qui ont \u00e9t\u00e9 entour\u00e9s de parenth\u00e8ses. Ainsi si on analyse une cha\u00eene contenant une date jj/mm/aa et si on veut de plus r\u00e9cup\u00e9rer les \u00e9l\u00e9ments jj, mm, aa de cette date on utilisera le mod\u00e8le (\\d\\d)/(\\d\\d)/(\\d\\d).</p> <p>Voyons sur cette exemple, comment on op\u00e8re avec vbscript.</p> <ul> <li> <p>il nous faut tout d'abord cr\u00e9er un objet RegExp (Regular Expression) <pre><code>set modele=new regexp\n</code></pre></p> </li> <li> <p>ensuite on fixe le mod\u00e8le \u00e0 tester <pre><code>modele.pattern=\"(\\d\\d)/(\\d\\d)/(\\d\\d)\"\n</code></pre></p> </li> <li> <p>on peut vouloir ne pas faire de diff\u00e9rence entre majuscules et minuscules (par d\u00e9faut elle est faite). Ici \u00e7a n'a aucune importance. <pre><code>modele.IgnoreCase=true\n</code></pre></p> </li> <li> <p>on peut vouloir rechercher le mod\u00e8le plusieurs fois dans la cha\u00eene (par d\u00e9faut ce n'est pas fait) <pre><code>modele.Global=true\n</code></pre></p> </li> </ul> <p>Une recherche globale n'a de sens que si le mod\u00e8le utilis\u00e9 ne fait pas r\u00e9f\u00e9rence au d\u00e9but ou \u00e0 la fin de la cha\u00eene.</p> <ul> <li>on recherche alors toutes les correspondances du mod\u00e8le dans la cha\u00eene : <pre><code>set correspondances=modele.execute(chaine)\n</code></pre></li> </ul> <p>La m\u00e9thode execute d'un objet RegExp rend une collection d'objets de type match. Cet objet a une propri\u00e9t\u00e9 value qui est l'\u00e9l\u00e9ment de chaine correspondant au mod\u00e8le. Si on a \u00e9crit modele.global=true, on peut avoir plusieurs correspondances. C'est pourquoi le r\u00e9sultat de la m\u00e9thode execute est une collection de correspondances.</p> <ul> <li>le nombre de correspondances est donn\u00e9 par correspondances.count. Si ce nombre vaut 0, c'est que le mod\u00e8le n'a \u00e9t\u00e9 trouv\u00e9 nulle part. La valeur de la correspondance n\u00b0 i est donn\u00e9e par correspondances(i).value. Si le mod\u00e8le contient des sous-mod\u00e8les entre parenth\u00e8ses, alors l'\u00e9l\u00e9ments de correspondances(i) correspondant \u00e0 la parenth\u00e8se j du mod\u00e8le est correspondances(i).submatches(j). Tout ceci est montr\u00e9 dans l'exemple qui suit :</li> </ul> <p>Programme</p> <pre><code>' expression r\u00e9guli\u00e8re\n\n' on veut v\u00e9rifier qu'une cha\u00eene contient une date au format jj/mm/aa\n\nOption Explicit\nDim modele\n\n' on d\u00e9finit le mod\u00e8le\nSet modele=new regexp\nmodele.pattern=\"\\b(\\d\\d)/(\\d\\d)/(\\d\\d)\\b\"  ' une date n'importe o\u00f9 dans la cha\u00eene\nmodele.global=true                      ' on recherchera le mod\u00e8le plusieurs fois dans la cha\u00eene\n\n' c'est l'utilisateur qui donne la cha\u00eene dans laquelle on cherchera le mod\u00e8le\nDim chaine, correspondances, i\n\nchaine=\"\"\n' on boucle tant que chaine&lt;&gt;\"fin\"\nDo While true\n' on demande \u00e0 l'utilisateur de taper un texte\nwscript.stdout.writeLine \"Tapez un texte contenant des dates au format jj/mm/aa et fin pour arr\u00eater : \"\nchaine=wscript.stdin.readLine\n' fini si chaine=fin\nIf chaine=\"fin\" Then Exit Do\n' on compare la cha\u00eene lue au mod\u00e8le de la date\nSet correspondances=modele.execute(chaine)\n' a-t-on trouv\u00e9 une correspondance\nIf correspondances.count&lt;&gt;0 Then\n' on a au moins une correspondance\nFor i=0 To correspondances.count-1\n' on affiche la correspondance i\nwscript.echo \"J'ai trouv\u00e9 la date \" &amp; correspondances(i).value\n' on r\u00e9cup\u00e8re les sous-\u00e9l\u00e9ments de la correspondance i\nwscript.echo \"Les \u00e9l\u00e9ments de la date \" &amp; i &amp; \" sont (\" &amp; correspondances(i).submatches(0) &amp; \",\" _\n&amp; correspondances(i).submatches(1) &amp; \",\" &amp; correspondances(i).submatches(2) &amp; \")\"\nNext\nElse\n' pas de correspondance\nwscript.echo \"Je n'ai pas trouv\u00e9 de date au format jj/mm/aa dans votre texte\"\nEnd If\nLoop\n\n' fini\nwscript.quit 0\n</code></pre> <p>R\u00e9sultats</p> <pre><code>Tapez un texte contenant des dates au format jj/mm/aa et fin pour arr\u00dbter :\naujourd'hui on est le 01/01/01 et demain sera le 02/01/02\nJ'ai trouv\u00e9 la date 01/01/01\nLes \u00e9l\u00e9ments de la date 0 sont (01,01,01)\nJ'ai trouv\u00e9 la date 02/01/02\nLes \u00e9l\u00e9ments de la date 1 sont (02,01,02)\n\nTapez un texte contenant des dates au format jj/mm/aa et fin pour arr\u00dbter :\nune date au format incorrect : 01/01/2002\nJe n'ai pas trouv\u00e9 de date au format jj/mm/aa dans votre texte\n\nTapez un texte contenant des dates au format jj/mm/aa et fin pour arr\u00dbter :\nune suite de dates : 10/10/10, 11/11/11, 12/12/12\nJ'ai trouv\u00e9 la date 10/10/10\nLes \u00e9l\u00e9ments de la date 0 sont (10,10,10)\nJ'ai trouv\u00e9 la date 11/11/11\nLes \u00e9l\u00e9ments de la date 1 sont (11,11,11)\nJ'ai trouv\u00e9 la date 12/12/12\nLes \u00e9l\u00e9ments de la date 2 sont (12,12,12)\n\nTapez un texte contenant des dates au format jj/mm/aa et fin pour arr\u00dbter :\nfin\n</code></pre> <p>Avec les expressions r\u00e9guli\u00e8res, le programme testant qu'une saisie clavier est bien un nombre entier positif pourrait s'\u00e9crire comme suit :</p> <p>Programme</p> <pre><code>' lecture d'une donn\u00e9e jusqu'\u00e0 ce que celle-ci soit reconnue comme un nombre\n\nOption Explicit\n\nDim fini, nombre\n\n' on d\u00e9finit le mod\u00e8le d'un nombre entier positif (mais qui peut \u00eatre nul)\nDim modele\nSet modele=new regexp\nmodele.pattern=\"^\\s*\\d+\\s*$\"\n\n' on boucle tant que la donn\u00e9e saisie n'est pas correcte\n' la boucle est contr\u00f4l\u00e9e par un bool\u00e9en fini, mis \u00e0 faux au d\u00e9part (= ce n'est pas fini)\n\nfini=false\nDo While Not fini\n' on demande le nombre\nwscript.stdout.write \"Tapez un nombre entier &gt;0: \"\n' on le lit\nnombre=wscript.stdin.readLine\n' on teste le format de la donn\u00e9e lue\nDim correspondances\nSet correspondances=modele.execute(nombre)\n' le mod\u00e8le a-t-il \u00e9t\u00e9 v\u00e9rifi\u00e9 ?\nIf correspondances.count&lt;&gt;0 Then\n' c'est un entier mais est-il &gt;0 ?\nnombre=cint(nombre)\nIf nombre&gt;0 Then\nfini=true\nEnd If\nEnd If\n' msg d'erreur \u00e9ventuel\nIf Not fini Then wscript.echo \"Erreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\"\nLoop\n\n' confirmation\nwscript.echo \"Merci pour le nombre entier &gt;0 : \" &amp; nombre\n\n' et fin\nwscript.quit 0\n</code></pre> <p>R\u00e9sultats</p> <pre><code>Tapez un nombre entier &gt;0: 10.3\nErreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\nTapez un nombre entier &gt;0: abcd\nErreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\nTapez un nombre entier &gt;0: -4\nErreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\nTapez un nombre entier &gt;0: 0\nErreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\nTapez un nombre entier &gt;0: 1\nMerci pour le nombre entier &gt;0 : 1\n</code></pre> <p>Trouver l'expression r\u00e9guli\u00e8re qui nous permet de v\u00e9rifier qu'une cha\u00eene correspond bien \u00e0 un certain mod\u00e8le est parfois un v\u00e9ritable d\u00e9fi. Le programme suivant permet de s'entra\u00eener. Il demande un mod\u00e8le et une cha\u00eene et indique alors si la cha\u00eene correspond ou non au mod\u00e8le.</p> <p>Programme</p> <pre><code>' expression r\u00e9guli\u00e8re\n\n' on veut v\u00e9rifier qu'une cha\u00eene correspond \u00e0 un mod\u00e8le\n\nOption Explicit\n\n' on d\u00e9finit le mod\u00e8le\nDim modele\nSet modele=new regexp\nmodele.global=true                      ' on recherchera le mod\u00e8le plusieurs fois dans la cha\u00eene\n\n' c'est l'utilisateur qui donne la cha\u00eene dans laquelle on cherchera le mod\u00e8le\nDim chaine, correspondances, i\n\nDo While true\n' on demande \u00e0 l'utilisateur de taper un mod\u00e8le\nwscript.stdout.write \"Tapez le mod\u00e8le \u00e0 tester et fin pour arr\u00eater : \"\nmodele.pattern=wscript.stdin.readLine\n' fini ?\nIf modele.pattern=\"fin\" Then Exit Do\n' on demande \u00e0 l'utilisateur les cha\u00eenes \u00e0 comparer au mod\u00e8le\nDo While true\n' on demande \u00e0 l'utilisateur de taper un mod\u00e8le\nwscript.stdout.writeLine \"Tapez la cha\u00eene \u00e0 tester avec le mod\u00e8le [\" &amp; modele.pattern &amp; \"] et fin pour arr\u00eater : \"\nchaine=wscript.stdin.readLine\n' fini ?\nIf chaine=\"fin\" Then Exit Do\n' on compare la cha\u00eene lue au mod\u00e8le de la date\nSet correspondances=modele.execute(chaine)\n' a-t-on trouv\u00e9 une correspondance\nIf correspondances.count&lt;&gt;0 Then\n' on a au moins une correspondance\nFor i=0 To correspondances.count-1\n' on affiche la correspondance i\nwscript.echo \"J'ai trouv\u00e9 la correspondance \" &amp; correspondances(i).value\nNext\nElse\n' pas de correspondance\nwscript.echo \"Je n'ai pas trouv\u00e9 de correspondance\"\nEnd If\nLoop\nLoop\n\n' fini\nwscript.quit 0\n</code></pre> <p>R\u00e9sultats</p> <pre><code>Tapez le mod\u00e8le \u00e0 tester et fin pour arr\u00eater : ^\\s*\\d+(\\,\\d+)*\\s*$\n\nTapez la cha\u00eene \u00e0 tester avec le mod\u00e8le [^\\s*\\d+(\\,\\d+)*\\s*$] et fin pour arr\u00eater :\n18\nJ'ai trouv\u00e9 la correspondance [18]\n\nTapez la cha\u00eene \u00e0 tester avec le mod\u00e8le [^\\s*\\d+(\\,\\d+)*\\s*$] et fin pour arr\u00eater :\n145.678\nJe n'ai pas trouv\u00e9 de correspondance\n\nTapez la cha\u00eene \u00e0 tester avec le mod\u00e8le [^\\s*\\d+(\\,\\d+)*\\s*$] et fin pour arr\u00eater :\n145,678\nJ'ai trouv\u00e9 la correspondance [  145,678   ]\n</code></pre>"},{"location":"la-gestion-des-erreurs.html#43-intercepter-les-erreurs-dexecution","title":"4.3. Intercepter les erreurs d'ex\u00e9cution","text":"<p>Une autre m\u00e9thode de gestion des erreurs d'ex\u00e9cution est de les laisser se produire, d'en \u00eatre avertis et de les g\u00e9rer alors. Normalement lorsqu'une erreur se passe \u00e0 l'ex\u00e9cution, WSH affiche un message d'erreur et le programme est arr\u00eat\u00e9. Deux instructions nous permettent de modifier ce fonctionnement :</p> <pre><code>on error resume next\n</code></pre> <p>Cette instruction indique au syst\u00e8me (WSH) que nous allons g\u00e9rer les erreurs nous-m\u00eames. Apr\u00e8s cette instruction, toute erreur est simplement ignor\u00e9e. par le syst\u00e8me.</p> <pre><code>on error goto 0\n</code></pre> <p>Cette instruction nous ram\u00e8ne au fonctionnement normal de gestion des erreurs.</p> <p>Lorsque l'instruction on error resume next est active, nous devons g\u00e9rer nous-m\u00eames les erreurs qui peuvent survenir. L'objet Err nous y aide. Cet objet a diverses propri\u00e9t\u00e9s et m\u00e9thodes dont nous retiendrons les deux suivantes :</p> <ul> <li>number : un nombre entier num\u00e9ro de la derni\u00e8re erreur qui s'est produite. 0 veut dire \"pas d'erreur\"</li> <li>description : le message d'erreur qu'aurait affich\u00e9 le syst\u00e8me si on n'avait pas \u00e9mis l'instruction on error resume next  Regardons l'exemple qui suit :</li> </ul> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>' erreur non g\u00e9r\u00e9e\n\nOption Explicit\nDim nombre\n\nnombre=cdbl(\"abcd\")\nwscript.echo \"nombre=\" &amp; nombre\n</code></pre> <pre><code>C:\\ err5.vbs(6, 1) Erreur d'ex\u00e9cution Microsoft VBScript: Type incompatible: 'cdbl'\n</code></pre> <p>G\u00e9rons maintenant l'erreur :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>' erreur g\u00e9r\u00e9e\n\nOption Explicit\nDim nombre\n\n' on g\u00e8re les erreurs nous-m\u00eames\nOn Error Resume Next\nnombre=cdbl(\"abcd\")\n' y-a-t-il eu erreur ?\nIf Err.number&lt;&gt;0 Then\nwscript.echo \"L'erreur [\" &amp; err.description &amp; \"] s'est produite\"\nOn Error GoTo 0\nwscript.quit 1\nEnd If\n' pas d'erreur - on revient au fonctionnement normal\nOn Error GoTo 0\nwscript.echo \"nombre=\" &amp; nombre\nwscript.quit 0\n</code></pre> <pre><code>L'erreur [Type incompatible] s'est produite\n</code></pre> <p>R\u00e9\u00e9crivons le programme de saisie d'un entier &gt;0 avec cette nouvelle m\u00e9thode :</p> <p>Programme</p> <pre><code>' lecture d'une donn\u00e9e jusqu'\u00e0 ce que celle-ci soit reconnue comme un nombre\n\nOption Explicit\n\nDim fini, nombre\n\n' on boucle tant que la donn\u00e9e saisie n'est pas correcte\n' la boucle est contr\u00f4l\u00e9e par un bool\u00e9en fini, mis \u00e0 faux au d\u00e9part (= ce n'est pas fini)\n\nfini=false\nDo While Not fini\n  ' on demande le nombre\n  wscript.stdout.write \"Tapez un nombre entier &gt;0: \"\n  ' on le lit\n  nombre=wscript.stdin.readLine\n  ' on teste le format de la donn\u00e9e lue\n  On Error Resume Next\n  nombre=cdbl(nombre)\n  If err.number=0 Then\n    ' pas d'erreur c'est un nombre\n    ' on revient au mode normal de gestion des erreurs\n    On Error GoTo 0\n    ' est-ce un entier &gt;0\n    If (nombre-int(nombre))=0 And nombre&gt;0 Then\n      fini=true\n    End If\n  End If\n  ' on revient au mode normal de gestion des erreurs\n  On Error GoTo 0\n  ' msg d'erreur \u00e9ventuel\n  If Not fini Then wscript.echo \"Erreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\"\nLoop\n\n' confirmation\nwscript.echo \"Merci pour le nombre entier &gt;0 : \" &amp; nombre\n\n' et fin\nwscript.quit 0\n</code></pre> <p>R\u00e9sultats</p> <pre><code>Tapez un nombre entier &gt;0: 4.5\nErreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\nTapez un nombre entier &gt;0: 4,5\nErreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\nTapez un nombre entier &gt;0: abcd\nErreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\nTapez un nombre entier &gt;0: -4\nErreur, vous n'avez pas tap\u00e9 un nombre entier &gt;0. Recommencez svp...\nTapez un nombre entier &gt;0: 1\nMerci pour le nombre entier &gt;0 : 1\n</code></pre> <p>Commentaires :</p> <ul> <li>Cette m\u00e9thode est parfois la seule utilisable. Il ne faut alors pas oublier de revenir au mode normal de gestion des erreurs d\u00e8s que la s\u00e9quence d'instructions susceptible de g\u00e9n\u00e9rer l'erreur est termin\u00e9e.</li> </ul>"},{"location":"la-gestion-des-erreurs.html#44-application-au-programme-de-calcul-dimpots","title":"4.4. Application au programme de calcul d'imp\u00f4ts","text":"<p>Nous reprenons le programme de calcul d'imp\u00f4ts d\u00e9j\u00e0 \u00e9crit pour, cette fois, v\u00e9rifier la validit\u00e9 des arguments pass\u00e9s au programme :</p> <p>Programme</p> <pre><code>' calcul de l'imp\u00f4t d'un contribuable\n' le programme doit \u00eatre appel\u00e9 avec trois param\u00e8tres : mari\u00e9 enfants salaire\n' mari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\n' enfants : nombre d'enfants\n' salaire : salaire annuel sans les centimes\n\n' aucune v\u00e9rification de la validit\u00e9 des donn\u00e9es n'est faite mais on\n' v\u00e9rifie qu'il y en a bien trois\n\n' d\u00e9claration obligatoire des variables\nOption Explicit\nDim syntaxe\nsyntaxe= _\n    \"Syntaxe : pg mari\u00e9 enfants salaire\" &amp; vbCRLF &amp; _\n    \"mari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\" &amp; vbCRLF &amp; _\n    \"enfants : nombre d'enfants (entier &gt;=0)\" &amp; vbCRLF &amp; _\n    \"salaire : salaire annuel sans les centimes (entier &gt;=0)\"\n\n' on v\u00e9rifie qu'il y a 3 arguments\n  Dim nbArguments\n  nbArguments=wscript.arguments.count\n  If nbArguments&lt;&gt;3 Then\n    ' msg d'erreur\n    wscript.echo syntaxe &amp; vbCRLF &amp; vbCRLF &amp; \"erreur : nombre d'arguments incorrect\"\n    ' arr\u00eat avec code d'erreur 1\n    wscript.quit 1\n  End If\n\n' on r\u00e9cup\u00e8re les arguments en v\u00e9rifiant leur validit\u00e9\n' un argument est transmis au programme sans espaces devant et derri\u00e8re\n' on utilisera des expression r\u00e9guli\u00e8res pour v\u00e9rifier la validit\u00e9 des donn\u00e9es\n  Dim modele, correspondances\n  Set modele=new regexp\n\n  ' le statut marital doit \u00eatre parmi les caract\u00e8res oOnN\n  modele.pattern=\"^[oOnN]$\"\n  Set correspondances=modele.execute(wscript.arguments(0))\n  If correspondances.count=0 Then\n    ' erreur\n    wscript.echo syntaxe &amp; vbCRLF &amp; vbCRLF &amp; \"erreur : argument marie incorrect\"\n    ' on quitte\n    wscript.quit 2\n  End If\n  ' on r\u00e9cup\u00e8re la valeur\n  Dim marie\n  If lcase(wscript.arguments(0)) = \"o\"Then\n    marie=true\n  Else\n    marie=false\n  End If\n\n  ' enfants doit \u00eatre un nombre entier &gt;=0\n  modele.pattern=\"^\\d{1,2}$\"\n  Set correspondances=modele.execute(wscript.arguments(1))\n  If correspondances.count=0 Then\n    ' erreur\n    wscript.echo syntaxe &amp; vbCRLF &amp; vbCRLF &amp; \"erreur : argument enfants incorrect\"\n    ' on quitte\n    wscript.quit 3\n  End If\n  ' on r\u00e9cup\u00e8re la valeur\n  Dim enfants\n  enfants=cint(wscript.arguments(1))\n\n  ' salaire doit \u00eatre un entier &gt;=0\n  modele.pattern=\"^\\d{1,9}$\"\n  Set correspondances=modele.execute(wscript.arguments(2))\n  If correspondances.count=0 Then\n    ' erreur\n    wscript.echo syntaxe &amp; vbCRLF &amp; vbCRLF &amp; \"erreur : argument salaire incorrect\"\n    ' on quitte\n    wscript.quit 4\n  End If\n  ' on r\u00e9cup\u00e8re la valeur\n  Dim salaire\n  salaire=clng(wscript.arguments(2))\n\n  ' on d\u00e9finit les donn\u00e9es n\u00e9cessaire au calcul de l'imp\u00f4t dans 3 tableaux\n  Dim limites, coeffn, coeffr\n  limites=array(12620,13190,15640,24740,31810,39970,48360, _\n    55790,92970,127860,151250,172040,195000,0)\n  coeffr=array(0,0.05,0.1,0.15,0.2,0.25,0.3,0.35,0.4,0.45, _\n    0.5,0.55,0.6,0.65)\n  coeffn=array(0,631,1290.5,2072.5,3309.5,4900,6898.5,9316.5, _\n    12106,16754.5,23147.5,30710,39312,49062)\n\n  ' on calcule le nombre de parts\n  Dim nbParts\n  If marie=true Then\n    nbParts=(enfants/2)+2\n  Else\n    nbParts=(enfants/2)+1\n  End If\n  If enfants&gt;=3 Then nbParts=nbParts+0.5\n\n  ' on calcule le quotient familial et le revenu imposable\n  Dim revenu, qf\n  revenu=0.72*salaire\n  qf=revenu/nbParts\n\n  ' on calcule l'imp\u00f4t\n  Dim i, impot\n  i=0\n  Do While i&lt;ubound(limites) And qf&gt;limites(i)\n    i=i+1\n  Loop\n  impot=int(revenu*coeffr(i)-nbParts*coeffn(i))\n\n  ' on affiche le r\u00e9sultat\n  wscript.echo \"imp\u00f4t=\" &amp; impot\n\n  ' on quitte sans erreur\n  wscript.quit 0\n</code></pre> <p>R\u00e9sultats</p> <pre><code>C:\\&gt;cscript impots2.vbs\n\nSyntaxe : pg mari\u00e9 enfants salaire\nmari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\nenfants : nombre d'enfants (entier &gt;=0)\nsalaire : salaire annuel sans les centimes (entier &gt;=0)\n\nerreur : nombre d'arguments incorrect\n\nC:\\&gt;cscript impots2.vbs a b c\n\nSyntaxe : pg mari\u00e9 enfants salaire\nmari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\nenfants : nombre d'enfants (entier &gt;=0)\nsalaire : salaire annuel sans les centimes (entier &gt;=0)\n\nerreur : argument marie incorrect\n\n\nC:\\&gt;cscript impots2.vbs o b c\n\nSyntaxe : pg mari\u00e9 enfants salaire\nmari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\nenfants : nombre d'enfants (entier &gt;=0)\nsalaire : salaire annuel sans les centimes (entier &gt;=0)\n\nerreur : argument enfants incorrect\n\nC:\\&gt;cscript impots2.vbs o 2 c\n\n\nSyntaxe : pg mari\u00e9 enfants salaire\nmari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\nenfants : nombre d'enfants (entier &gt;=0)\nsalaire : salaire annuel sans les centimes (entier &gt;=0)\n\nerreur : argument salaire incorrect\n\nC:\\&gt;cscript impots2.vbs o 2 200000\n\nimp\u00f4t=22504\n</code></pre>"},{"location":"les-bases-de-la-programmation-vbscript.html","title":"3. Les bases de la programmation VBSCRIPT","text":"<p>Apr\u00e8s avoir d\u00e9crit les contextes d'ex\u00e9cution possibles pour un script vbscript, nous abordons maintenant le langage lui-m\u00eame. Dans toute la suite, nous nous pla\u00e7ons dans les conditions suivantes :</p> <ul> <li>le conteneur du script est WSH</li> <li> <p>le script est plac\u00e9 dans un fichier de suffixe .vbs Pour pr\u00e9senter un concept, nous op\u00e9rons en g\u00e9n\u00e9ral de la fa\u00e7on suivante :</p> </li> <li> <p>on introduit le concept si besoin est</p> </li> <li>on pr\u00e9sente un programme d'illustration avec ses r\u00e9sultats</li> <li>on commente les r\u00e9sultats et le programme si besoin est Les conteneurs vbscript ne sont pas sensibles \u00e0 la \"casse\" utilis\u00e9e (majuscules/minuscules) dans le texte du script. Aussi pourra-t-on \u00e9crire indiff\u00e9remment wscript.echo \"coucou\" ou WSCRIPT.ECHO \"coucou\".</li> </ul> <p>Les programmes pr\u00e9sent\u00e9s dans la suite font beaucoup d'\u00e9critures \u00e0 l'\u00e9cran aussi allons-nous pr\u00e9senter de nouveau les m\u00e9thodes d'\u00e9criture de l'objet wscript.</p>"},{"location":"les-bases-de-la-programmation-vbscript.html#31-afficher-des-informations","title":"3.1. Afficher des informations","text":"<p>Nous avons d\u00e9j\u00e0 utilis\u00e9 la m\u00e9thode echo de l'objet wscript mais ce dernier a d'autres m\u00e9thodes permettant d'\u00e9crire \u00e0 l'\u00e9cran comme le montre le script suivant :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>un\ndeuxtrois\nquatre\ncinq\n</code></pre> <p>On notera les points suivants :</p> <ul> <li>Toute texte plac\u00e9 apr\u00e8s une apostrophe est consid\u00e9r\u00e9 comme un commentaire du script et n'est pas interpr\u00e9t\u00e9 par WSH ( ligne 1).</li> <li>la m\u00e9thode echo \u00e9crit ses arguments et passe \u00e0 la ligne suivante de m\u00eame que la m\u00e9thode writeLine (lignes 2 et 6)</li> <li>la m\u00e9thode write \u00e9crit ses arguments et ne passe pas \u00e0 la ligne suivante (ligne 3)</li> <li>une marque de fin de ligne est repr\u00e9sent\u00e9e par la suite de deux caract\u00e8res de codes ASCII 13 et 10. Ainsi ligne 4 est-elle repr\u00e9sent\u00e9e par l'expression chr(13) &amp; chr(10) o\u00f9 chr(i) est le caract\u00e8re de code ASCII i et &amp; l'op\u00e9rateur de concat\u00e9nation de cha\u00eene. Ainsi \"chat\" &amp; \"eau\" est la cha\u00eene \"chateau\".</li> <li>la marque de fin de ligne peut \u00eatre repr\u00e9sent\u00e9e plus facilement par la constante vbCRLF (ligne 5)</li> </ul>"},{"location":"les-bases-de-la-programmation-vbscript.html#32-ecriture-des-instructions-dans-un-script-vbscript","title":"3.2. Ecriture des instructions dans un script Vbscript","text":"<p>Par d\u00e9faut, on \u00e9crit une instruction par ligne. N\u00e9anmoins, on peut \u00e9crire plusieurs instructions par ligne en les s\u00e9parant par le caract\u00e8re : comme dans inst1:inst2:inst3. Si une ligne est trop longue, on peut la d\u00e9couper en morceaux. Il faut alors que les diff\u00e9rentes parties de l'instruction soient termin\u00e9es par les deux caract\u00e8res (espace)_. Nous reprenons l'exemple pr\u00e9c\u00e9dent en r\u00e9\u00e9crivant diff\u00e9remment les instructions :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>un\ndeuxtrois\nquatre\ncinq\n</code></pre>"},{"location":"les-bases-de-la-programmation-vbscript.html#33-ecrire-avec-la-fonction-msgbox","title":"3.3. \u00c9crire avec la fonction msgBox","text":"<p>Si dans ce document, nous utilisons quasi exclusivement l'objet wscript pour \u00e9crire \u00e0 l'\u00e9cran, il existe une fonction plus sophistiqu\u00e9e pour afficher des informations dans une fen\u00eatre cette fois-ci. C'est la fonction msgbox qui s'utilise en g\u00e9n\u00e9ral avec trois param\u00e8tres :</p> <p>msgbox message, ic\u00f4nes+boutons, titre</p> <ul> <li>message est le texte du message \u00e0 afficher</li> <li>ic\u00f4nes+boutons (facultatif) est en fait un nombre qui indique le type d'ic\u00f4ne et les boutons \u00e0 placer dans la fen\u00eatre du message. Ce nombre est le plus souvent la somme de deux nombres : le premier d\u00e9termine l'ic\u00f4ne, le second les boutons</li> <li>titre est le texte \u00e0 placer dans la barre de titre de la fen\u00eatre de message Les valeurs \u00e0 utiliser pour pr\u00e9ciser l'ic\u00f4ne et les boutons de la fen\u00eatre d'affichage sont les suivantes :</li> </ul> <p>Constante</p><p>Valeur</p><p>Description</p><p>vbOKOnly</p><p>\u00a0\u00a0\u00a00</p><p>Affiche uniquement le bouton OK.</p><p>vbOKCancel</p><p>\u00a0\u00a0\u00a01</p><p>Affiche les boutons OK et Annuler.</p><p>vbAbortRetryIgnore</p><p>\u00a0\u00a0\u00a02</p><p>Affiche les boutons Abandon, R\u00e9essayer et Ignorer.</p><p>vbYesNoCancel</p><p>\u00a0\u00a0\u00a03</p><p>Affiche les boutons Oui, Non et Annuler.</p><p>vbYesNo</p><p>\u00a0\u00a0\u00a04</p><p>Affiche les boutons Oui et Non.</p><p>vbRetryCancel</p><p>\u00a0\u00a0\u00a05</p><p>Affiche les boutons R\u00e9essayer et Annuler.</p><p>vbCritical</p><p>16</p><p>Affiche l'ic\u00f4ne Message critique. </p><p>vbQuestion</p><p>32</p><p>Affiche l'ic\u00f4ne Demande d'avertissement.</p><p>vbExclamation</p><p>48</p><p>Affiche l'ic\u00f4ne Message d'avertissement.</p><p>vbInformation</p><p>64</p><p>Affiche l'ic\u00f4ne Message d'information.</p><p>vbDefaultButton1</p><p>\u00a0\u00a0\u00a00</p><p>Le premier bouton est le bouton par d\u00e9faut.</p><p>vbDefaultButton2</p><p>\u00a0256</p><p>Le deuxi\u00e8me bouton est le bouton par d\u00e9faut.</p><p>vbDefaultButton3</p><p>\u00a0512</p><p>Le troisi\u00e8me bouton est le bouton par d\u00e9faut.</p><p>vbDefaultButton4</p><p>\u00a0768</p><p>Le quatri\u00e8me bouton est le bouton par d\u00e9faut.</p><p>vbApplicationModal</p><p>\u00a0\u00a0\u00a00</p><p>Application modale\u00a0; l'utilisateur doit r\u00e9pondre au message avant de continuer \u00e0 travailler dans l'application courante.</p><p>vbSystemModal</p><p>4096</p><p>Syst\u00e8me modal\u00a0; toutes les applications sont suspendues jusqu'\u00e0 ce que l'utilisateur r\u00e9ponde au message.</p> <p>Voici des exemples :</p> <p>Programme</p><p>R\u00e9sultats</p> <p>Dans certains cas, on pr\u00e9sente une fen\u00eatre d'information qui est \u00e9galement une fen\u00eatre de saisie. Si on pose une question, on veut par exemple savoir si l'utilisateur a cliqu\u00e9 sur le bouton oui ou sur le bouton non. La fonction msgBox rend un r\u00e9sultat que dans le programme pr\u00e9c\u00e9dent nous n'avons pas utilis\u00e9. Ce r\u00e9sultat est un nombre entier repr\u00e9sentant le bouton utilis\u00e9 par l'utilisateur pour fermer la fen\u00eatre d'affichage :</p> <p>Constante</p><p>Valeur</p><p>Bouton choisi</p><p>vbOK</p><p>1</p><p>OK</p><p>vbCancel</p><p>2</p><p>Annuler</p><p>vbAbort</p><p>3</p><p>Abandon</p><p>vbRetry</p><p>4</p><p>R\u00e9essayer </p><p>vbIgnore</p><p>5</p><p>Ignorer</p><p>vbYes</p><p>6</p><p>Oui</p><p>vbNo</p><p>7</p><p>Non</p> <p>Le programme suivant montre l'utilisation du r\u00e9sultat de la fonction msgBox. On pr\u00e9sente 4 fois une fen\u00eatre avec les boutons oui, non, annuler. On r\u00e9pond de la fa\u00e7on suivante :</p> <ul> <li>on clique sur oui</li> <li>on clique sur non</li> <li>on clique sur annuler</li> <li>on ferme la fen\u00eatre sans utiliser de bouton. Le programme montre que cela revient \u00e0 utiliser le bouton Annuler.</li> </ul> <p>Programme</p><p>R\u00e9sultats</p>"},{"location":"les-bases-de-la-programmation-vbscript.html#34-les-donnees-utilisables-en-vbscript","title":"3.4. Les donn\u00e9es utilisables en Vbscript","text":"<p>VBscript ne conna\u00eet qu'un type de donn\u00e9es : le variant. La valeur d'un variant peut \u00eatre un nombre (4, 10.2), une cha\u00eene de caract\u00e8res (\"bonjour\"), un bool\u00e9en (true/false), une date (#01/01/2002#), l'adresse d'un objet, un ensemble de toutes ces donn\u00e9es plac\u00e9es dans une structure appel\u00e9e tableau.</p> <p>Examinons le programme suivant et ses r\u00e9sultats :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>4\ni=4\n10,2\nr1=10,2\n0,014\nr2=0,014\nc1=bonjour\n01/10/02\nd1=01/10/02\n10/01/02\nd2=10/01/02\n-1\nb1=Vrai\n0\nb2=Faux\nv=4\nv=10,2\nv=bonjour\nv=01/10/02\nv=Vrai\n</code></pre> <p>Commentaires :</p> <ul> <li>un certain nombre de langages de programmation (C, C++, Pascal, Java, C#, ...) exigent la d\u00e9claration pr\u00e9alable d'une variable avant son utilisation. Cette d\u00e9claration consiste \u00e0 indiquer le nom de la variable et le type de donn\u00e9es elle peut contenir (entier, r\u00e9el, cha\u00eene, date, bool\u00e9en, ...). La d\u00e9claration des variables permet diff\u00e9rentes choses :</li> <li>conna\u00eetre la place m\u00e9moire n\u00e9cessaire \u00e0 la variable si diff\u00e9rents types de donn\u00e9es n\u00e9cessitent diff\u00e9rents espaces m\u00e9moire</li> <li> <p>de v\u00e9rifier la coh\u00e9rence du programme. Ainsi si i est un entier et c une cha\u00eene de caract\u00e8res, multiplier i par c n'a aucun sens. Si le type des variables i et c a \u00e9t\u00e9 d\u00e9clar\u00e9 par le programmeur, le programme charg\u00e9 d'analyser le programme avant son ex\u00e9cution peut signaler une telle incoh\u00e9rence. Comme la plupart des langages de script \u00e0 type de donn\u00e9es unique (Perl, Python, Javascript, ...) Vbscript autorise de ne pas d\u00e9clarer les variables. C'est ce qui a \u00e9t\u00e9 fait dans l'exemple ci-dessus.</p> </li> <li> <p>notons la syntaxe de diff\u00e9rentes donn\u00e9es</p> </li> <li>10.2 en ligne 10 (point d\u00e9cimal et non virgule). On notera qu'\u00e0 l'affichage c'est 10,2 qui est affich\u00e9.</li> <li>1.4e-2 en ligne 13 (notation scientifique). A l'affichage, c'est le nombre 0,014 qui a \u00e9t\u00e9 affich\u00e9</li> <li>[#01/10/2002#] (ligne 26) pour repr\u00e9senter la date du 10 janvier 2002. C'est donc le format #mm/jj/aaaa# que vbscript utilise pour repr\u00e9senter la date jj du mois mm de l'ann\u00e9e aaaa</li> <li>les bool\u00e9ens true et false (vrai/faux) en lignes 31 et 34. Ces deux valeurs sont repr\u00e9sent\u00e9es respectivement par les entiers -1 et 0 comme le montre l'affichage des lignes 32 et 35. Lorsqu'un bool\u00e9en est concat\u00e9n\u00e9 \u00e0 une cha\u00eene de caract\u00e8res, ces valeurs deviennent respectivement les cha\u00eenes \"Vrai\" et \"Faux\" comme le montrent les lignes 33 et 36. On remarquera au passage que l'op\u00e9rateur &amp; de concat\u00e9nation peut servir \u00e0 concat\u00e9ner autre chose que des cha\u00eenes.</li> <li>une variable v n'ayant pas de type assign\u00e9, elle peut accueillir successivement dans le temps des valeurs de diff\u00e9rents types.</li> </ul>"},{"location":"les-bases-de-la-programmation-vbscript.html#35-les-sous-types-du-type-variant","title":"3.5. Les sous-types du type variant","text":"<p>Voici que dit la documentation officielle sur les diff\u00e9rents types de donn\u00e9es que peut contenir un variant :</p> <p>Au-del\u00e0 de la simple distinction nombre/cha\u00eene, un Variant peut distinguer diff\u00e9rents types d'information num\u00e9rique. Par exemple, certaines informations num\u00e9riques repr\u00e9sentent une date ou une heure. Lorsque ces informations sont utilis\u00e9es avec d'autres donn\u00e9es de date ou d'heure, le r\u00e9sultat est toujours exprim\u00e9 sous la forme d'une date ou d'une heure. Vous disposez aussi d'autres types d'information num\u00e9rique, des valeurs bool\u00e9ennes jusqu'aux grands nombres \u00e0 virgule flottante. Ces diff\u00e9rentes cat\u00e9gories d'information qui peuvent \u00eatre contenues dans un Variant sont des sous-types. Dans la plupart des cas, vous placez simplement vos donn\u00e9es dans un Variant et celui-ci se comporte de la fa\u00e7on la plus appropri\u00e9e en fonction de ces donn\u00e9es.</p> <p>Le tableau suivant pr\u00e9sente diff\u00e9rents sous-types susceptibles d'\u00eatre contenus dans un Variant.</p> <p>Sous-type</p><p>Description</p><p>Empty</p><p>Le Variant n'est pas initialis\u00e9. Sa valeur est \u00e9gale \u00e0 z\u00e9ro pour les variables num\u00e9riques et \u00e0 une cha\u00eene de longueur nulle (\"\") pour les variables cha\u00eene.</p><p>Null</p><p>Le Variant contient intentionnellement des donn\u00e9es incorrectes. </p><p>Boolean</p><p>Contient True (vrai) ou False (faux).</p><p>Byte</p><p>Contient un entier de 0 \u00e0 255. </p><p>Integer</p><p>Contient un entier de -32\u00a0768 \u00e0 32\u00a0767. </p><p>Currency</p><p>-922 337 203 685 477,5808 \u00e0 922 337 203 685 477,5807.</p><p>Long</p><p>Contient un entier de -2 147 483 648 \u00e0 2 147 483 647.</p><p>Single</p><p>Contient un nombre \u00e0 virgule flottante en pr\u00e9cision simple de -3,402823E38 \u00e0 -1,401298E-45 pour les\u00a0valeurs\u00a0n\u00e9gatives\u00a0; de 1,401298E-45 \u00e0 3,402823E38 pour les\u00a0valeurs\u00a0positives.</p><p>Double</p><p>Contient un nombre \u00e0 virgule flottante en pr\u00e9cision double de -1,79769313486232E308 \u00e0 -4,94065645841247E-324 pour les\u00a0valeurs\u00a0n\u00e9gatives\u00a0; de 4,94065645841247E-324 \u00e0 1,79769313486232E308 pour les\u00a0valeurs\u00a0positives.</p><p>Date (Time)</p><p>Contient un nombre qui repr\u00e9sente une date entre le 1er janvier 100 et le 31 d\u00e9cembre 9999.</p><p>String</p><p>Contient une cha\u00eene de longueur variable limit\u00e9e \u00e0 environ 2 milliards de caract\u00e8res.</p><p>Object</p><p>Contient un objet.</p><p>Error</p><p>Contient un num\u00e9ro d'erreur.</p>"},{"location":"les-bases-de-la-programmation-vbscript.html#36-connaitre-le-type-exact-de-la-donnee-contenue-dans-un-variant","title":"3.6. Conna\u00eetre le type exact de la donn\u00e9e contenue dans un variant","text":"<p>Une variable de type variant peut contenir des donn\u00e9es de divers types. Il nous faut quelquefois conna\u00eetre la nature exacte de ces donn\u00e9es. Si dans un programme nous \u00e9crivons produit=nombre1*nombre2, nous supposons que nombre1 et nombre2 sont deux donn\u00e9es num\u00e9riques. Parfois nous n'en sommes pas s\u00fbrs car ces valeurs peuvent provenir d'une saisie au clavier, d'un fichier, d'une source ext\u00e9rieure quelconque. Il nous faut alors v\u00e9rifier la nature des donn\u00e9es plac\u00e9es dans nombre1 et nombre2. La fonction typename(var) nous permet de conna\u00eetre le type de donn\u00e9es contenue dans la variable var. Voici des exemples :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>var=1,type=Integer\nvar=deux,type=String\nvar=Vrai,type=Boolean\nvar=4,5,type=Double\nvar=11/10/01,type=Date\n</code></pre> <p>Une autre fonction possible est vartype(var) qui rend un nombre repr\u00e9sentant le type de la donn\u00e9e contenue par la variable var :</p> <p>Constante</p><p>Valeur</p><p>Description</p><p>vbEmpty</p><p>0</p><p>Empty (non initialis\u00e9e)</p><p>vbNull</p><p>1</p><p>Null (aucune donn\u00e9e valide)</p><p>vbInteger</p><p>2</p><p>Entier</p><p>vbLong</p><p>3</p><p>Entier long </p><p>vbSingle</p><p>4</p><p>Nombre en virgule flottante en simple pr\u00e9cision</p><p>vbDouble</p><p>5</p><p>Nombre en virgule flottante en double pr\u00e9cision</p><p>vbCurrency</p><p>6</p><p>Mon\u00e9taire</p><p>vbDate</p><p>7</p><p>Date</p><p>vbString</p><p>8</p><p>Cha\u00eene</p><p>vbObject</p><p>9</p><p>Objet Automation</p><p>vbError</p><p>10</p><p>Erreur</p><p>vbBoolean</p><p>11</p><p>Bool\u00e9en</p><p>vbVariant</p><p>12</p><p>Variant (utilis\u00e9 seulement avec des tableaux de Variants)</p><p>vbDataObject</p><p>13</p><p>Objet non Automation</p><p>vbByte</p><p>17</p><p>Octet</p><p>vbArray</p><p>8192</p><p>Tableau</p> <p>Remarque\u00a0\u00a0\u00a0Ces constantes sont sp\u00e9cifi\u00e9es par VBScript. En cons\u00e9quence, les noms peuvent \u00eatre utilis\u00e9s n'importe o\u00f9 dans votre code \u00e0 la place des valeurs r\u00e9elles.</p> <p>Les informations ci-dessus proviennent de la documentation de VBscript. Celle-ci est parfois incorrecte, issue probablement de copier-coller faits \u00e0 partir de la documentation de VB. La fonction vartype de VBScript ne fait qu'une partie de ce qui est annonc\u00e9 ci-dessus.</p> <p>Le programme pr\u00e9c\u00e9dent, r\u00e9\u00e9crit pour vartype donne les r\u00e9sultats suivants :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>var=1,type=2\nvar=deux,type=8\nvar=Vrai,type=11\nvar=4,5,type=5\nvar=11/10/01,type=7\n</code></pre>"},{"location":"les-bases-de-la-programmation-vbscript.html#37-declarer-les-variables-utilisees-par-le-script","title":"3.7. D\u00e9clarer les variables utilis\u00e9es par le script","text":"<p>Nous avons indiqu\u00e9 qu'il n'\u00e9tait pas obligatoire de d\u00e9clarer les variables utilis\u00e9es par le script. Dans ce cas, si nous \u00e9crivons :</p> <pre><code>1) somme=4\n...\n2) somme=smme+10\n</code></pre> <p>avec une faute de frappe smme au lieu de somme dans l'instruction 2, vbscript ne signalera aucune erreur. Il supposera que smme est une nouvelle variable. Il la cr\u00e9era et dans le contexte de l'instruction 2 l'utilisera en l'initialisant \u00e0 0.</p> <p>Ce genre d'erreurs peut \u00eatre tr\u00e8s difficile \u00e0 retrouver. Aussi est-il conseill\u00e9 de forcer la d\u00e9claration des variables avec la directive option explicit plac\u00e9e en d\u00e9but de script. Ensuite toute variable doit \u00eatre d\u00e9clar\u00e9e avec une instruction dim avant sa premi\u00e8re utilisation : </p> <pre><code>option explicit\n...\ndim somme\n1) somme=4\n...\n2) somme=smme+10\n</code></pre> <p>Dans cet exemple, vbscript indiquera qu'il y a une variable non d\u00e9clar\u00e9e smme en 2) comme le montre l'exemple qui suit :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>dim1.vbs(9, 1) Erreur d'ex\u00e9cution Microsoft VBScript: Variable non d\u00e9finie: 'smme'\n</code></pre> <p>Si dans les courts exemples du document, les variables ne sont la plupart du temps pas d\u00e9clar\u00e9es, nous forcerons leur d\u00e9claration d\u00e8s que nous \u00e9crirons les premiers scripts significatifs. La directive Option explicit sera alors utilis\u00e9e syst\u00e9matiquement.</p>"},{"location":"les-bases-de-la-programmation-vbscript.html#38-les-fonctions-de-conversion","title":"3.8. Les fonctions de conversion","text":"<p>Vbscript transforme les donn\u00e9es des variants en cha\u00eenes, nombres, bool\u00e9ens, ... selon le contexte. La plupart du temps, cela fonctionne bien mais parfois cela donne quelques surprises comme nous le verrons ult\u00e9rieurement. On peut alors vouloir \"forcer\" le type de donn\u00e9e du variant. VBscript poss\u00e8de des fonctions de conversion qui transforment une expression en divers types de donn\u00e9es. En voici quelques unes :</p> <p>Cint (expression)</p><p>transforme expression en entier court (integer)</p><p>Clng (expression)</p><p>transforme expression en entier long (long)</p><p>Cdbl (expression)</p><p>transforme expression en r\u00e9el double (double)</p><p>Csng (expression)</p><p>transforme expression en r\u00e9el simple (single)</p><p>Ccur (expression)</p><p>transforme expression en donn\u00e9e mon\u00e9taire (currency)</p> <p>Voici quelques exemples :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>var=4,code type=8,nom type=String\nvar=4,code type=2,nom type=Integer\nvar=1000000,code type=8,nom type=String\nvar=1000000,code type=3,nom type=Long\nvar=3,4e-5,code type=8,nom type=String\nvar=0,000034,code type=5,nom type=Double\nvar=3,4e-5,code type=8,nom type=String\nvar=0,000034,code type=4,nom type=Single\nvar=1000,45,code type=8,nom type=String\nvar=1000,45,code type=6,nom type=Currency\nvar=14,code type=2,nom type=Integer\nvar=14,code type=8,nom type=String\nvar=1000,45,code type=5,nom type=Double\nvar=1000,code type=2,nom type=Integer\nvar=1000,75,code type=5,nom type=Double\nvar=1001,code type=2,nom type=Integer\n</code></pre>"},{"location":"les-bases-de-la-programmation-vbscript.html#39-lire-des-donnees-tapees-au-clavier","title":"3.9. Lire des donn\u00e9es tap\u00e9es au clavier","text":"<p>L'objet wscript permet \u00e0 un script de r\u00e9cup\u00e9rer des donn\u00e9es tap\u00e9es au clavier. La m\u00e9thode wscript.stdin.readLine permet de lire une ligne de texte tap\u00e9e au clavier et valid\u00e9e par la touche \"Entr\u00e9e\". Cette ligne lue peut \u00eatre affect\u00e9e \u00e0 une variable.</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>Tapez votre nom : st\nBonjour st\n</code></pre> <p>Commentaires :</p> <ul> <li>Dans la colonne des r\u00e9sultats et dans la ligne [Tapez votre nom : st] , st est la ligne tap\u00e9e par l'utilisateur. Si le texte tap\u00e9 au clavier repr\u00e9sente un nombre, il est quand m\u00eame consid\u00e9r\u00e9 avant tout comme une cha\u00eene de caract\u00e8res comme le montre l'exemple ci-dessous :</li> </ul> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>Tapez un nombre : 14\nnombre lu=14,type=String\n</code></pre> <p>Si ce nombre intervient dans une op\u00e9ration arithm\u00e9tique, VBscript fera automatiquement la conversion de la cha\u00eene vers un nombre mais pas toujours. Regardons l'exemple qui suit :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>nombre1 : 3\nnombre2 : 4\n3+4=34\n3-4=-1\n3x4=12\n3/4=0,75\n</code></pre> <p>Dans les r\u00e9sultats, on voit que la ligne 8 du script ne s'est pas d\u00e9roul\u00e9e comme attendu, ceci parce que (malheureusement) en vbscript l'op\u00e9rateur + a deux significations : addition de deux nombres ou concat\u00e9nation de deux cha\u00eenes (les deux cha\u00eenes sont coll\u00e9es l'une \u00e0 l'autre). Nous avons vu pr\u00e9c\u00e9demment que les nombres tap\u00e9s au clavier \u00e9taient lus comme \u00e9tant des cha\u00eenes de caract\u00e8res et que vbscript transformait celles-ci en nombres selon les besoins. Il l'a correctement fait pour les op\u00e9rations -,*,/ qui ne peuvent faire intervenir que des nombres mais pas pour l'op\u00e9rateur + qui lui peut \u00e9galement faire intervenir des cha\u00eenes. Il a suppos\u00e9 ici qu'on voulait faire une concat\u00e9nation de cha\u00eenes.</p> <p>Une solution simple \u00e0 ce probl\u00e8me est de transformer en nombres les cha\u00eenes d\u00e8s leur lecture comme le montre l'am\u00e9lioration qui suit du programme pr\u00e9c\u00e9dent :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>nombre1 : 3\nnombre1=3,type=String\nnombre1=3,type=Long\nnombre2 : 4\nnombre2=4,type=String\nnombre2=4,type=Long\n3+4=7\n3-4=-1\n3x4=12\n3/4=0,75\n</code></pre> <pre><code>\n</code></pre>"},{"location":"les-bases-de-la-programmation-vbscript.html#310-saisir-des-donnees-avec-la-fonction-inputbox","title":"3.10. Saisir des donn\u00e9es avec la fonction inputbox","text":"<p>On peut vouloir saisir des donn\u00e9es dans une interface graphique plut\u00f4t qu'au clavier. On utilise alors la fonction inputBox. Celle-ci admet de nombreux param\u00e8tres dont seuls les deux premiers sont fr\u00e9quemment utilis\u00e9s :</p> <p>reponse=inputBox(message,titre)</p> <ul> <li>message : la question que vous posez \u00e0 l'utilisateur</li> <li>titre (facultatif) : le titre que vous donnez \u00e0 la fen\u00eatre de saisie</li> <li>reponse : le texte tap\u00e9 par l'utilisateur. Si celui-ci a ferm\u00e9 la fen\u00eatre sans r\u00e9pondre, reponse est la cha\u00eene vide. Voici un exemple o\u00f9 on demande le nom et l'\u00e2ge d'une personne. Pour le nom on donne une information et on fait OK. Pour l'\u00e2ge, on donne \u00e9galement une information mais on fait Annuler.</li> </ul> <p>Programme</p><p>R\u00e9sultats</p>"},{"location":"les-bases-de-la-programmation-vbscript.html#311-utiliser-des-objets-structures","title":"3.11. Utiliser des objets structur\u00e9s","text":"<p>Il est possible de cr\u00e9er avec vbscript des objets ayant des m\u00e9thodes et des propri\u00e9t\u00e9s. Pour ne pas compliquer les choses, nous allons pr\u00e9senter ici un objet avec des propri\u00e9t\u00e9s et pas de m\u00e9thodes. Consid\u00e9rons une personne. Elle a de nombreuses propri\u00e9t\u00e9s qui la caract\u00e9risent : taille, poids, couleur de peau, des yeux, des cheveux, ... Nous n'en retiendrons que deux : son nom et son \u00e2ge. Avant de pouvoir utiliser des objets, il faut cr\u00e9er le moule qui va permettre de les fabriquer. Cela se fait en vbscript avec une classe. La classe personne pourrait \u00eatre d\u00e9finie comme suit :</p> <pre><code>class personne\nDim nom,age\nEnd class\n</code></pre> <p>C'est l'instruction [Dim nom,age] qui d\u00e9finit les deux propri\u00e9t\u00e9s de la classe personne. Pour cr\u00e9er des exemplaires (on parle d'instances) de la classe personne, on \u00e9crit :</p> <pre><code>set personne1=new personne\nset personne2=new personne\n</code></pre> <p>Pourquoi ne pas \u00e9crire </p> <pre><code>personne1=new personne\npersonne2=new personne\n</code></pre> <p>Parce qu'un variant ne peut contenir un objet. Il peut seulement en contenir l'adresse. En \u00e9crivant set personne1=new personne, la s\u00e9quence d'\u00e9v\u00e9nements suivante prend place :</p> <ul> <li>un objet personne est cr\u00e9\u00e9. Cela veut dire que de la m\u00e9moire lui est allou\u00e9e.</li> <li>l'adresse de cet objet personne est affect\u00e9e \u00e0 la variable personne1 Nous avons alors le sch\u00e9ma m\u00e9moire suivant pour les variables personne1 et personne2 :</li> </ul> <p>Par abus de langage, on pourra dire que personne1 est un objet personne. On peut accepter cet abus de langage si on se rappelle que personne1 est en fait l'adresse d'un objet personne et non l'objet personne lui-m\u00eame.</p> <p>Nous avons dit qu'un objet personne avait deux propri\u00e9t\u00e9s nom et age. Comment exploiter ces propri\u00e9t\u00e9s ? Par la notation objet.propri\u00e9t\u00e9 comme il a \u00e9t\u00e9 expliqu\u00e9 un peu plus haut. Ainsi</p> <p>personne1.nom d\u00e9signe le nom de la personne 1 et personne1.age son \u00e2ge. Voici un court programme d'illustration :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>p1=(dupont,18)\n</code></pre> <p>Le programme pr\u00e9c\u00e9dent pourrait \u00eatre modifi\u00e9 comme suit :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>nom=dupont\nage=18\n</code></pre> <p>Nous avons utilis\u00e9 ici la structure with ... end with qui permet de \"factoriser\" des noms d'objets dans des expressions. La structure with p1 ... end with des lignes 9-12 et 15-18 permet d'utiliser ensuite la syntaxe .nom en lieu et place de p1.nom et .age en lieu et place de p1.age. Cela permet d'all\u00e9ger l'\u00e9criture des instructions o\u00f9 le m\u00eame nom d'objet est utilis\u00e9e de fa\u00e7on r\u00e9p\u00e9t\u00e9e.</p>"},{"location":"les-bases-de-la-programmation-vbscript.html#312-affecter-une-valeur-a-une-variable","title":"3.12. Affecter une valeur \u00e0 une variable","text":"<p>Il y a deux instructions pour affecter une valeur \u00e0 une variable :</p> <ul> <li>variable=expression</li> <li> <p>set variable=expression La forme 2 est r\u00e9serv\u00e9e aux expressions dont le r\u00e9sultat est une r\u00e9f\u00e9rence d'objet. Pour tous les autres types d'expressions c'est la forme 1 qui convient. La diff\u00e9rence entre les deux formes est la suivante :</p> </li> <li> <p>dans l'instruction variable=expression, variable re\u00e7oit une valeur. Si v1 et v2 sont deux variables, \u00e9crire v1=v2 affecte la valeur de v1 \u00e0 v2. On a donc la duplication d'une valeur \u00e0 deux endroits diff\u00e9rents. Si par la suite, la valeur de v2 est modifi\u00e9e, celle de v1 ne l'est en rien.</p> </li> </ul> <ul> <li>dans l'instruction set variable=expression, variable re\u00e7oit comme valeur l'adresse d'un objet. Si v1 et v2 sont deux variables et si v2 est l'adresse d'un objet obj2, \u00e9crire set v1=v2 affecte la valeur de v1 \u00e0 v2, donc l'adresse de l'objet obj2. Lorsque le script manipule ensuite v1 et v2, ce ne sont pas les \"valeurs\" de v1 et v2 qui sont manipul\u00e9es mais bien les objets \"point\u00e9s\" par v1 et v2, donc le m\u00eame objet ici. On dit que v1 et v2 sont deux r\u00e9f\u00e9rences au m\u00eame objet et manipuler ce dernier via v1 ou v2 ne fait aucune diff\u00e9rence. Dit autrement, modifier l'objet r\u00e9f\u00e9renc\u00e9 par v2 modifie celui r\u00e9f\u00e9renc\u00e9 par v1.</li> </ul> <p>Voici un exemple :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>i=4\nj=4\ni=4\nj=5\np1.nom=dupont\np1.age=18\np1.nom=dupont\np1.age=19\np2.nom=dupont\np2.age=19\n</code></pre>"},{"location":"les-bases-de-la-programmation-vbscript.html#313-evaluer-des-expressions","title":"3.13. \u00c9valuer des expressions","text":"<p>Les principaux op\u00e9rateurs permettant d'\u00e9valuer des expressions sont les suivantes :</p> <p>Type d'op\u00e9rateurs</p><p>Op\u00e9rateurs</p><p>Exemple</p><p>Arithm\u00e9tique</p><p>+,-,*,/</p> <p>mod</p><p>a mod b donne le reste de la division enti\u00e8re de a par b. Auparavant a et b ont \u00e9t\u00e9 transform\u00e9s en entiers si besoin \u00e9tait.</p><p>\\</p><p>a \\ b donne le quotient de la division enti\u00e8re de a par b. Auparavant a et b ont \u00e9t\u00e9 transform\u00e9s en entiers si besoin \u00e9tait.</p><p>^</p><p>a^b \u00e9l\u00e8ve a \u00e0 la puissance b. Ainsi a^2 est \u00e9gal \u00e0 a2</p> <p>Comparaison</p><p>&lt;,&lt;=</p><p>&gt;, &gt;=</p><p>=,&lt;&gt;</p><p>a&lt;&gt;b est vrai si a est diff\u00e9rent de b</p><p>a=b est vrai si a est \u00e9gal \u00e0 b</p><p>a et b peuvent \u00eatre tous deux des nombres ou tous deux des cha\u00eenes de caract\u00e8res. Dans ce dernier cas, chaine1&lt;chaine2 si dans l'ordre alphab\u00e9tique chaine1 pr\u00e9c\u00e8de chaine2. Dans la comparaison de cha\u00eenes, les majuscules pr\u00e9c\u00e8dent les minuscules dans l'ordre alphab\u00e9tique.</p><p>is</p><p>obj1 is obj2 est vrai si obj1 et obj2 sont des r\u00e9f\u00e9rences sur le m\u00eame objet.</p> <p>Logique</p><p>and, or, not, xor</p><p>Les op\u00e9randes sont tous ici bool\u00e9ens.</p><p>bool1 or bool2 est vrai si bool1 ou bool2 est vrai</p><p>bool1 and bool2 est vrai si bool1 et bool2 sont vrais</p><p>not bool1 est vrai si bool1 est faux et vice-versa</p><p>bool1 xor bool2 est vrai si seulement un seul des bool\u00e9ens bool1, bool2 est vrai</p> <p>Concat\u00e9nation</p><p>&amp;, +</p><p> Il est d\u00e9conseill\u00e9 d'utiliser l'op\u00e9rateur + pour concat\u00e9ner deux cha\u00eenes \u00e0 cause de la confusion possible avec l'addition de deux nombres. On utilisera donc exclusivement l'op\u00e9rateur &amp;.</p>"},{"location":"les-bases-de-la-programmation-vbscript.html#314-controler-lexecution-du-programme","title":"3.14. Contr\u00f4ler l'ex\u00e9cution du programme","text":""},{"location":"les-bases-de-la-programmation-vbscript.html#3141-executer-des-actions-de-facon-conditionnelle","title":"3.14.1. Ex\u00e9cuter des actions de fa\u00e7on conditionnelle","text":"<p>L'instruction vbscript permettant de faire des actions selon la valeur vraie/fausse d'une condition est la suivante :</p> <pre><code>if expression then\n    action-vrai-1\n    action-vrai-2\n    ..\nelse\n    action-faux-1\n    action-faux-2\n    ...\nend if\n</code></pre> <p>L'expression expression est tout d'abord \u00e9valu\u00e9e. Cette expression doit avoir une valeur bool\u00e9enne. Si elle a la valeur vrai, les actions du then sont ex\u00e9cut\u00e9es sinon ce sont celles du else s'il est pr\u00e9sent.</p> <p>Suit un programme pr\u00e9sentant diff\u00e9rentes variantes du if-then-else :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>3 est plus grand que 0\n3 est plus grand que 2\ni=4\n4 est plus petit que 10\ni=3\n</code></pre> <p>Commentaires :</p> <ul> <li>en vbscript, on peut \u00e9crire instruction1:instruction2:... : instructionn au lieu d'\u00e9crire une instruction par ligne. C'est cette possibilit\u00e9 qui a \u00e9t\u00e9 exploit\u00e9e en ligne 10 par exemple.</li> </ul>"},{"location":"les-bases-de-la-programmation-vbscript.html#3142-executer-des-actions-de-facon-repetee","title":"3.14.2. Ex\u00e9cuter des actions de fa\u00e7on r\u00e9p\u00e9t\u00e9e","text":"<p>Boucle \u00e0 nombre d'it\u00e9rations connu</p> <pre><code>for i=id\u00e9but to ifin step ipas\n    actions\nnext\n</code></pre> <p>\u2022 la variable i est ici appel\u00e9e variable de boucle. Elle peut porter un nom quelconque</p><p>\u2022 i prend la valeur id\u00e9but</p><p>\u2022 la valeur de i est compar\u00e9e \u00e0 ifin. Si i&lt;=ifin, les actions situ\u00e9es entre le for... next sont ex\u00e9cut\u00e9es</p><p>\u2022 i est incr\u00e9ment\u00e9 de la quantit\u00e9 ipas (i=i+ipas)</p><p>\u2022 on reboucle \u00e0 l'\u00e9tape 3 pr\u00e9c\u00e9dente. Au bout d'un nombre fini d'\u00e9tapes, la valeur de i d\u00e9passera ifin. L'ex\u00e9cution du script se poursuit avec l'instruction qui suit le next</p><p>\u2022 si l'incr\u00e9ment ipas est n\u00e9gatif, la condition de l'\u00e9tape 3 est chang\u00e9e. On ex\u00e9cute les actions du for...next que si i&gt;=ifin.</p><p>On peut sortir d'une boucle for \u00e0 tout moment avec l'instruction exit for.</p><p>Boucle \u00e0 nombre d'it\u00e9rations inconnu</p> <pre><code>do while condition\n    actions\nloop\n</code></pre> <p>\u2022 l'expression condition est \u00e9valu\u00e9e. Si elle est vraie, les actions du while...loop sont ex\u00e9cut\u00e9es</p><p>\u2022 les actions ex\u00e9cut\u00e9es ont pu modifier la valeur de condition. On reboucle sur l'\u00e9tape 1 pr\u00e9c\u00e9dente.</p><p>\u2022 lorsque l'expression condition devient fausse, la boucle est termin\u00e9e</p><p>On peut sortir d'une boucle do while \u00e0 tout moment avec l'instruction exit do.</p> <p>Le programme ci-dessous illustre ces points :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>i=0,tableau(i)=10,somme=10\ni=1,tableau(i)=20,somme=30\ni=2,tableau(i)=30,somme=60\ni=3,tableau(i)=40,somme=100\ni=0,tableau(i)=10,somme=10\ni=1,tableau(i)=20,somme=30\ni=2,tableau(i)=30,somme=60\ni=1\ni=2\ni=3\ni=4\ni=5\ni=6\ni=7\ni=8\ni=9\ni=10\ni=11\ni=1\ni=2\ni=3\ni=4\ni=5\ni=6\n</code></pre> <p>Note : Dans la phase de d\u00e9veloppement d'un programme, il n'est pas rare qu'un programme \"boucle\", c.a.d. qu'il ne s'arr\u00eate jamais. En g\u00e9n\u00e9ral, le programme ex\u00e9cute une boucle dont la condition de sortie ne peut \u00eatre v\u00e9rifi\u00e9e comme par exemple dans l'exemple qui suit :</p> <pre><code>' boucle infinie\ni=0\nDo While 1=1\n  i=i+1\n  wscript.echo i\nLoop\n\n' une autre du m\u00eame genre\ni=0\nDo While true\n  i=i+1\n  wscript.echo i\nLoop\n</code></pre> <p>Si on ex\u00e9cute le programme pr\u00e9c\u00e9dent, la premi\u00e8re boucle ne s'arr\u00eatera jamais d'elle-m\u00eame. On peut forcer son arr\u00eat en tapant CTRL-C au clavier (touche CTRL et touche C enfonc\u00e9es en m\u00eame temps).</p>"},{"location":"les-bases-de-la-programmation-vbscript.html#3143-terminer-lexecution-du-programme","title":"3.14.3. Terminer l'ex\u00e9cution du programme","text":"<p>L'instruction wscript.quit n termine l'ex\u00e9cution du programme en renvoyant un code d'erreur \u00e9gal \u00e0 n. Sous DOS, ce code d'erreur peut \u00eatre test\u00e9 avec l'instruction if ERRORLEVEL n qui est vrai si le code d'erreur renvoy\u00e9 par le dernier programme ex\u00e9cut\u00e9 est &gt;=n. Consid\u00e9rons le programme suivant et ses r\u00e9sultats :</p> <pre><code>d\u00e9but\n</code></pre> <p>Juste apr\u00e8s l'ex\u00e9cution du programme, on \u00e9met les trois commandes DOS suivantes :</p> <pre><code>C:\\&gt;if ERRORLEVEL 5 echo 5\n\nC:\\&gt;if ERRORLEVEL 4 echo 4\n4\n\nC: &gt;if ERRORLEVEL 3 echo 3\n3\n</code></pre> <p>La commande DOS 1 teste si le code d'erreur retourn\u00e9 par le programme est &gt;=5. Si oui, elle affiche (echo) 5 sinon rien.</p> <p>La commande DOS 2 teste si le code d'erreur retourn\u00e9 par le programme est &gt;=4. Si oui, elle affiche 4 sinon rien.</p> <p>La commande DOS 3 teste si le code d'erreur retourn\u00e9 par le programme est &gt;=3. Si oui, elle affiche 3 sinon rien.</p> <p>Des r\u00e9sultats affich\u00e9s, on peut d\u00e9duire que le code d'erreur retourn\u00e9 par le programme \u00e9tait 4.</p>"},{"location":"les-bases-de-la-programmation-vbscript.html#315-les-tableaux-de-donnees-dans-un-variant","title":"3.15. Les tableaux de donn\u00e9es dans un variant","text":"<p>Un variant T peut contenir une liste de valeurs. On dit alors que c'est un tableau. Un tableau T poss\u00e8de diverses propri\u00e9t\u00e9s :</p> <ul> <li>on a acc\u00e8s \u00e0 l'\u00e9l\u00e9ment i du tableau T par la syntaxe T(i) o\u00f9 i est un entier appel\u00e9 indice entre 0 et n-1 si T a n \u00e9l\u00e9ments.</li> <li>on peut conna\u00eetre l'indice du dernier \u00e9l\u00e9ment du tableau T avec l'expression ubound(T). Le nombre d'\u00e9l\u00e9ments du tableau T est alors ubound(T)+1. On appelle souvent ce nombre la taille du tableau.</li> <li>un variant T peut \u00eatre initialis\u00e9 avec un tableau vide par la syntaxe T=array() ou avec une suite d'\u00e9l\u00e9ments par la syntaxe T=array(\u00e9l\u00e9ment0, \u00e9l\u00e9ment1, ...., \u00e9l\u00e9mentn)</li> <li>on peut ajouter des \u00e9l\u00e9ments \u00e0 un tableau T d\u00e9j\u00e0 cr\u00e9\u00e9. Pour cela, on utilise l'instruction redim preserve T(N) o\u00f9 N est le nouvel indice du dernier \u00e9l\u00e9ment du tableau T. L'op\u00e9ration est appel\u00e9e un redimensionnement (redim). Le mot cl\u00e9 preserve indique que lors de ce redimensionnement, le contenu actuel du tableau doit \u00eatre pr\u00e9serv\u00e9. En l'absence de ce mot cl\u00e9, T est redimensionn\u00e9 et vid\u00e9 de ses \u00e9l\u00e9ments.</li> <li>un \u00e9l\u00e9ment T(i) du tableau T est de type variant et peut donc contenir n'importe quelle valeur et en particulier un tableau. Dans ce cas, la notation T(i)(j) d\u00e9signe l'\u00e9l\u00e9ment j du tableau T(i). Ces diverses propri\u00e9t\u00e9s des tableaux sont illustr\u00e9es par le programme qui suit :</li> </ul> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>Le tableau t1 a 5 \u00e9l\u00e9ments\nt1(0)=1\nt1(1)=-4,5\nt1(2)=deux\nt1(3)=Vrai\nt1(4)=10/01/02\nt1=1:-4,5:deux:Vrai:10/01/02\nt1(5)=10:20:30\nt1(5)(1)=20\nt1=1 ~ -4,5 ~ deux\nt1=:::\n</code></pre> <p>Commentaires</p> <ul> <li>on a utilis\u00e9 ici une fonction appel\u00e9e join explicit\u00e9e un peu plus loin.</li> </ul>"},{"location":"les-bases-de-la-programmation-vbscript.html#316-les-variables-tableaux","title":"3.16. Les variables tableaux","text":"<p>Il existe en vbscript une autre fa\u00e7on d'utiliser un tableau, c'est d'utiliser une variable tableau. Une telle variable doit alors \u00eatre obligatoirement d\u00e9clar\u00e9e contrairement aux variables scalaires par une instruction dim. Diverses d\u00e9clarations sont possibles :</p> <ul> <li>dim tableau(n) d\u00e9clare un tableau statique de n+1 \u00e9l\u00e9ments num\u00e9rot\u00e9s de 0 \u00e0 n. Ce type de tableau ne peut pas \u00eatre redimensionn\u00e9</li> <li>dim tableau() d\u00e9clare un tableau dynamique vide. Il devra \u00eatre redimensionn\u00e9 pour \u00eatre utilis\u00e9 par l'instruction redim de la m\u00eame mani\u00e8re que pour un variant contenant un tableau</li> <li>dim tableau(n,m) d\u00e9clare un tableau \u00e0 2 dimensions de (n+1)*(m+1) \u00e9l\u00e9ments. L'\u00e9l\u00e9ment (i,j) du tableau est not\u00e9 tableau(i,j). On notera la diff\u00e9rence avec un variant o\u00f9 le m\u00eame \u00e9l\u00e9ment aurait \u00e9t\u00e9 not\u00e9 tableau(i)(j). Pourquoi deux types de tableaux qui finalement sont tr\u00e8s proches ? La documentation de vbscript n'en parle pas et n'indique pas non plus si l'un est plus performant que l'autre. Par la suite, nous utiliserons quasi exclusivement le tableau dans un variant dans nos exemples. On se rappellera cependant que VBscript d\u00e9rive du langage Visual Basic qui contient lui des donn\u00e9es typ\u00e9es (integer, double, boolean, ...). Dans ce cas, si on doit utiliser un tableau de nombres r\u00e9els par exemple, la variable tableau sera plus performante que la variable variant. On d\u00e9clarera alors quelque chose comme dim tableau(1000) as double pour d\u00e9clarer un tableau de nombres r\u00e9els ou simplement dim tableau() as double si le tableau est dynamique.</li> </ul> <p>Voici un exemple illustrant l'utilisation de variables tableau :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>Le tableau t1 a 5 \u00e9l\u00e9ments\nt1(0)=1\nt1(1)=-4,5\nt1(2)=deux\nt1(3)=Vrai\nt1(4)=10/01/02\nt1=1:-4,5:deux:Vrai:10/01/02\nLe tableau t1 a 5 \u00e9l\u00e9ments\nt2(0)=0\nt2(1)(2)=30\nt2=:::\nt3(0,0)=0\nt3(0,1)=1\nt3(1,0)=10\nt3(1,1)=11\n</code></pre>"},{"location":"les-bases-de-la-programmation-vbscript.html#317-les-fonctions-split-et-join","title":"3.17. Les fonctions split et join","text":"<p>Les fonctions split et join permettent de passer d'une cha\u00eene de caract\u00e8res \u00e0 un tableau et vice-versa :</p> <ul> <li>Si T est un tableau et car une cha\u00eene de caract\u00e8res, join(T,car) est une cha\u00eene de caract\u00e8res form\u00e9e par la r\u00e9union de tous les \u00e9l\u00e9ments du tableau T, chacun \u00e9tant s\u00e9par\u00e9 du suivant par la cha\u00eene car. Ainsi join(array(1,2,3),\"abcd\") donnera la cha\u00eene \"1abcd2abcd3\"</li> <li>Si C est une cha\u00eene de caract\u00e8res form\u00e9e d'une suite de champs s\u00e9par\u00e9s par la cha\u00eene car la fonction split(C,car) est un tableau dont les \u00e9l\u00e9ments sont les diff\u00e9rents de la cha\u00eene C. Ainsi split(\"1abcd2abcd3\",\"abcd\") donnera le tableau (1,2,3) Voici un exemple :</li> </ul> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>' transformation tableau--&gt;cha\u00eene et vice-versa\n\n' tableau --&gt; chaine\ntableau=array(\"un\",2,\"trois\")\nchaine=join(tableau,\",\")\nwscript.echo chaine\n\n' chaine --&gt; tableau\ntableau2=split(chaine,\",\")\nFor i=0 To ubound(tableau2)\n  wscript.echo tableau2(i)\nNext\n</code></pre> <pre><code>un,2,trois\nun\n2\ntrois\n</code></pre>"},{"location":"les-bases-de-la-programmation-vbscript.html#318-les-dictionnaires","title":"3.18. Les dictionnaires","text":"<p>On a acc\u00e8s \u00e0 l'\u00e9l\u00e9ment d'un tableau T lorsqu'on conna\u00eet son num\u00e9ro i. Il est alors accessible par la notation T(i). Il existe des tableaux dont on acc\u00e8e aux \u00e9l\u00e9ments, non pas par un num\u00e9ro mais par une cha\u00eene de caract\u00e8res. L'exemple typique de ce type de tableau est le dictionnaire. Lorsqu'on cherche la signification d'un mot dans le \"Larousse\" ou \"Le petit Robert\", on acc\u00e8de \u00e0 celle-ci par le mot. On pourrait repr\u00e9senter ce dictionnaire par un tableau \u00e0 2 colonnes :</p> <p>mot1</p><p>description1</p><p>mot2</p><p>description2</p><p>mot3</p><p>description3</p><p>....</p> <p>On pourrait alors \u00e9crire des choses comme :</p> <p>dictionnaire(\"mot1\")=\"description1\"</p> <p>dictionnaire(\"mot2\")=\"description2\"</p> <p>...</p> <p>On est alors proche du fonctionnement d'un tableau si ce n'est que les indices du tableau ne sont pas des nombres entiers mais des cha\u00eenes de caract\u00e8res. On appelle ce type de tableau un dictionnaire (ou tableau associatif, hashtable) et les indices cha\u00eenes de caract\u00e8res les cl\u00e9s du dictionnaire (keys). L'usage des dictionnaires est extr\u00eamement fr\u00e9quent dans le monde informatique. Nous avons tous une carte de s\u00e9curit\u00e9 sociale avec dessus un num\u00e9ro. Ce num\u00e9ro nous identifie de fa\u00e7on unique et donne acc\u00e8s aux informations qui nous concernent. Dans le mod\u00e8le dictionnaire(\"cl\u00e9\")=\"informations\", \"cl\u00e9\" serait ici le n\u00b0 de s\u00e9curit\u00e9 sociale et \"informations\" toutes les informations stock\u00e9es \u00e0 notre sujet sur les ordinateurs de la s\u00e9curit\u00e9 sociale.</p> <p>Sous Windows, on dispose d'un objet Active X appel\u00e9 \"Scripting.Dictionary\" qui permet de cr\u00e9er et g\u00e9rer des dictionnaires. Un objet Active X est un composant logiciel qui expose une interface utilisable par des programmes qui peuvent \u00eatre \u00e9crits en diff\u00e9rents langages, tant qu'ils respectent la norme d'utilisation des objets Active X. L'objet Scripting.dictionary est donc utilisable par les langages de programmation de Windows : javascript, per, python, C, C++, vb, vba,... et pas seulement par vbscript.</p> <p>1</p><p>Un objet Scripting.Dictionary est cr\u00e9\u00e9 par une instruction</p><p> set dico=wscript.CreateObject(\"Scripting.Dictionary\")</p><p>ou simplement</p><p> set dico=CreateObject(\"Scripting.Dictionary\")</p><p>CreateObject est une m\u00e9thode de l'objet WScript permettant de cr\u00e9er des instances d'objets Active X. La version 2 montre que wscript peut \u00eatre un objet implicite. Lorsqu'une m\u00e9thode ne peut \u00eatre \"rapproch\u00e9e\" d'un objet, le conteneur WSH essaiera de le rapprocher de l'objet wscript.</p><p>2</p><p>Une fois le dictionnaire cr\u00e9\u00e9, on va pouvoir lui ajouter des \u00e9l\u00e9ments avec la m\u00e9thode add :</p><p> dico.add \"cl\u00e9\",valeur</p><p>va cr\u00e9er une nouvelle entr\u00e9e dans le dictionnaire associ\u00e9e \u00e0 la cl\u00e9 \"cl\u00e9\". La valeur associ\u00e9e est un variant dont une donn\u00e9e quelconque.</p><p>3</p><p>Pour r\u00e9cup\u00e9rer la valeur associ\u00e9e \u00e0 une cl\u00e9 donn\u00e9e on utilise la m\u00e9thode item du dictionnaire :</p><p> var=dico.item(\"cl\u00e9\")</p><p>ou    set var=dico.item(\"cl\u00e9) si la valeur associ\u00e9e \u00e0 la cl\u00e9 est un objet.</p><p>4</p><p>L'ensemble des cl\u00e9s du dictionnaire peut \u00eatre r\u00e9cup\u00e9r\u00e9 dans un tableau variant gr\u00e2ce \u00e0 la m\u00e9thode keys :</p><p> cl\u00e9s=dico.keys</p><p>cl\u00e9s est un tableau dont on peut parcourir les \u00e9l\u00e9ments.</p><p>5</p><p>L'ensemble des valeurs du dictionnaire peut \u00eatre r\u00e9cup\u00e9r\u00e9 dans un tableau variant gr\u00e2ce \u00e0 la m\u00e9thode items :</p><p> valeurs=dico.items</p><p>items est un tableau dont on peut parcourir les \u00e9l\u00e9ments.</p><p>6</p><p>L'existence d'une cl\u00e9 peut \u00eatre test\u00e9e avec la m\u00e9thode exists :</p><p> dico.exists(\"cl\u00e9\") est vrai si la cl\u00e9 \"cl\u00e9\" existe dans le dictionnaire</p><p>7</p><p>On peut enlever une entr\u00e9e du dictionnaire (cl\u00e9+valeur) avec la m\u00e9thode remove :</p><p> dico.remove(\"cl\u00e9\") enl\u00e8ve l'entr\u00e9e du dictionnaire associ\u00e9e \u00e0 la cl\u00e9 \"cl\u00e9\".     dico.removeall enl\u00e8ve toutes les cl\u00e9s, c.a.d. vide le dictionnaire.</p> <p>Le programme suivant utilise ces diverses possibilit\u00e9s :</p> <p>Programme</p> <pre><code>' cr\u00e9ation et utilisation d'un dictionnaire\nSet dico=CreateObject(\"Scripting.Dictionary\")\n\n' remplisage dico\ndico.add \"cl\u00e91\",\"valeur1\"\ndico.add \"cl\u00e92\",\"valeur2\"\ndico.add \"cl\u00e93\",\"valeur3\"\n\n' nombre d'\u00e9l\u00e9ments\nwscript.echo \"Le dictionnaire a \" &amp; dico.count &amp; \" \u00e9l\u00e9ments\"\n\n' liste des cl\u00e9s\nwscript.echo \"liste des cl\u00e9s\"\ncles=dico.keys\nFor i=0 To ubound(cles)\n  wscript.echo cles(i)\nNext\n\n' liste des valeurs\nwscript.echo \"liste des valeurs\"\nvaleurs=dico.items\nFor i=0 To ubound(valeurs)\n  wscript.echo valeurs(i)\nNext\n\n' liste des cl\u00e9s et valeurs\nwscript.echo \"liste des cl\u00e9s et valeurs\"\ncles=dico.keys\nFor i=0 To ubound(cles)\n  wscript.echo \"dico(\" &amp; cles(i) &amp; \")=\" &amp; dico.item(cles(i))\nNext\n\n' recherche d'\u00e9l\u00e9ments\n' cl\u00e91\nIf dico.exists(\"cl\u00e91\") Then\n    wscript.echo \"La cl\u00e9 cl\u00e91 existe dans le dictionnaire et la valeur associ\u00e9e est \" &amp; dico.item(\"cl\u00e91\")\n  Else\n    wscript.echo \"La cl\u00e9 cl\u00e91  n'existe pas dans le dictionnaire\"\n  End If\n' cl\u00e94  \nIf dico.exists(\"cl\u00e94\") Then\n    wscript.echo \"La cl\u00e9 cl\u00e94 existe dans le dictionnaire et la valeur associ\u00e9e est \" &amp; dico.item(\"cl\u00e94\")\n  Else\n    wscript.echo \"La cl\u00e9 cl\u00e94  n'existe pas dans le dictionnaire\"\n  End If\n\n' on enl\u00e8ve la cl\u00e9 1\ndico.remove(\"cl\u00e91\")\n\n' liste des cl\u00e9s et valeurs\nwscript.echo \"liste des cl\u00e9s et valeurs apr\u00e8s suppression de cl\u00e91\"\ncles=dico.keys\nFor i=0 To ubound(cles)\n  wscript.echo \"dico(\" &amp; cles(i) &amp; \")=\" &amp; dico.item(cles(i))\nNext\n\n' on supprime tout\ndico.removeall\n\n' liste des cl\u00e9s et valeurs\nwscript.echo \"liste des cl\u00e9s et valeurs apr\u00e8s suppression de tous les \u00e9l\u00e9ments\"\ncles=dico.keys\nFor i=0 To ubound(cles)\n  wscript.echo \"dico(\" &amp; cles(i) &amp; \")=\" &amp; dico.item(cles(i))\nNext\n\n' fin\nwscript.quit 0\n</code></pre> <p>R\u00e9sultats</p> <pre><code>Le dictionnaire a 3 \u00e9l\u00e9ments\nliste des cl\u00e9s\ncl\u00e91\ncl\u00e92\ncl\u00e93\nliste des valeurs\nvaleur1\nvaleur2\nvaleur3\nliste des cl\u00e9s et valeurs\ndico(cl\u00e91)=valeur1\ndico(cl\u00e92)=valeur2\ndico(cl\u00e93)=valeur3\nLa cl\u00e9 cl\u00e91 existe dans le dictionnaire et la valeur associ\u00e9e est valeur1\nLa cl\u00e9 cl\u00e94  n'existe pas dans le dictionnaire\nliste des cl\u00e9s et valeurs apr\u00e8s suppression de cl\u00e91\ndico(cl\u00e92)=valeur2\ndico(cl\u00e93)=valeur3\nliste des cl\u00e9s et valeurs apr\u00e8s suppression de tous les \u00e9l\u00e9ments\n</code></pre>"},{"location":"les-bases-de-la-programmation-vbscript.html#319-trier-un-tableau-ou-un-dictionnaire","title":"3.19. Trier un tableau ou un dictionnaire","text":"<p>Il est courant de vouloir trier un tableau ou un dictionnaire dans l'ordre croissant ou d\u00e9croissant de ses valeurs ou de ses cl\u00e9s pour un dictionnaire. Alors que dans la pupart des langages, existent des fonctions de tri, il ne semble pas en exister en vbscript. C'est une lacune.</p>"},{"location":"les-bases-de-la-programmation-vbscript.html#320-les-arguments-dun-programme","title":"3.20. Les arguments d'un programme","text":"<p>Il est possible d'appeler un programme vbscript en lui passant des param\u00e8tres comme dans :</p> <p>cscript prog1.vbs arg1 arg2 .... argn</p> <p>Cela permet \u00e0 l'utilisateur de passer des informations au programme. Comment celui-ci fait-il pour les r\u00e9cup\u00e9rer ? Regardons le programme suivant :</p> <p>Programme</p><p>R\u00e9sultats</p> <pre><code>C:\\&gt;cscript arg1.vbs a b c\n\nIl y a 3 arguments\na\nb\nc\n</code></pre> <p>Commentaires</p> <ul> <li>WScript.Arguments est la collection des arguments pass\u00e9s au script</li> <li>une collection C est un objet qui a</li> <li>une propri\u00e9t\u00e9 count qui est le nombre d'\u00e9l\u00e9ments dans la collection</li> <li>une m\u00e9thode C(i) qui donne l'\u00e9l\u00e9ment i de la collection</li> </ul>"},{"location":"les-bases-de-la-programmation-vbscript.html#321-une-premiere-application-impots","title":"3.21. Une premi\u00e8re application : IMPOTS","text":"<p>On se propose d'\u00e9crire un programme permettant de calculer l'imp\u00f4t d'un contribuable. On se place dans le cas simplifi\u00e9 d'un contribuable n'ayant que son seul salaire \u00e0 d\u00e9clarer :</p> <ul> <li>on calcule le nombre de parts du salari\u00e9 nbParts=nbEnfants/2 +1 s'il n'est pas mari\u00e9, nbEnfants/2+2 s'il est mari\u00e9, o\u00f9 nbEnfants est son nombre d'enfants.</li> <li>on calcule son revenu imposable R=0.72*S o\u00f9 S est son salaire annuel</li> <li>on calcule son coefficient familial Q=R/N on calcule son imp\u00f4t I d'apr\u00e8s les donn\u00e9es suivantes</li> </ul> <p>12620.0    </p><p>0</p><p>0</p><p>13190    </p><p>0.05    </p><p>631</p><p>15640    </p><p>0.1    </p><p>1290.5</p><p>24740    </p><p>0.15    </p><p>2072.5</p><p>31810    </p><p>0.2    </p><p>3309.5</p><p>39970    </p><p>0.25    </p><p>4900</p><p>48360    </p><p>0.3    </p><p>6898.5</p><p>55790    </p><p>0.35    </p><p>9316.5</p><p>92970    </p><p>0.4    </p><p>12106</p><p>127860    </p><p>0.45    </p><p>16754.5</p><p>151250    </p><p>0.50    </p><p>23147.5</p><p>172040    </p><p>0.55    </p><p>30710</p><p>195000    </p><p>0.60    </p><p>39312</p><p>0    </p><p>0.65    </p><p>49062</p> <p>Chaque ligne a 3 champs. Pour calculer l'imp\u00f4t I, on recherche la premi\u00e8re ligne o\u00f9 QF&lt;=champ1. Par exemple, si QF=30000 on trouvera la ligne </p> <pre><code>    24740        0.15        2072.5\n</code></pre> <p>L'imp\u00f4t I est alors \u00e9gal \u00e0 0.15*R - 2072.5*nbParts. Si QF est tel que la relation QF&lt;=champ1 n'est jamais v\u00e9rifi\u00e9e, alors ce sont les coefficcients de la derni\u00e8re ligne qui sont utilis\u00e9s. Ici :</p> <pre><code>    0                0.65        49062\n</code></pre> <p>ce qui donne l'imp\u00f4t I=0.65*R - 49062*nbParts.</p> <p>Le programme est le suivant :</p> <p>Programme</p> <pre><code>' calcul de l'imp\u00f4t d'un contribuable\n' le programme doit \u00eatre appel\u00e9 avec trois param\u00e8tres : mari\u00e9 enfants salaire\n' mari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\n' enfants : nombre d'enfants\n' salaire : salaire annuel sans les centimes\n\n' aucune v\u00e9rification de la validit\u00e9 des donn\u00e9es n'est faite mais on\n' v\u00e9rifie qu'il y en a bien trois\n\n' d\u00e9claration obligatoire des variables\nOption Explicit\n\n' on v\u00e9rifie qu'il y a 3 arguments\nDim nbArguments\nnbArguments=wscript.arguments.count\nIf nbArguments&lt;&gt;3 Then\nwscript.echo \"Syntaxe : pg mari\u00e9 enfants salaire\"\nwscript.echo \"mari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\"\nwscript.echo \"enfants : nombre d'enfants\"\nwscript.echo \"salaire : salaire annuel sans les centimes\"\n' arr\u00eat avec code d'erreur 1\nwscript.quit 1\nEnd If\n\n' on r\u00e9cup\u00e8re les arguments sans v\u00e9rifier leur validit\u00e9\nDim marie, enfants, salaire\nIf wscript.arguments(0) = \"O\" Or wscript.arguments(0)=\"o\" Then\nmarie=true\nElse\nmarie=false\nEnd If\n' enfants est un nombre entier\nenfants=cint(wscript.arguments(1))\n' salaire est un entier long\nsalaire=clng(wscript.arguments(2))\n\n' on d\u00e9finit les donn\u00e9es n\u00e9cessaire au calcul de l'imp\u00f4t dans 3 tableaux\nDim limites, coeffn, coeffr\nlimites=array(12620,13190,15640,24740,31810,39970,48360, _\n55790,92970,127860,151250,172040,195000,0)\ncoeffr=array(0,0.05,0.1,0.15,0.2,0.25,0.3,0.35,0.4,0.45, _\n0.5,0.55,0.6,0.65)\ncoeffn=array(0,631,1290.5,2072.5,3309.5,4900,6898.5,9316.5, _\n12106,16754.5,23147.5,30710,39312,49062)\n\n' on calcule le nombre de parts\nDim nbParts\nIf marie=true Then\nnbParts=(enfants/2)+2\nElse\nnbParts=(enfants/2)+1\nEnd If\nIf enfants&gt;=3 Then nbParts=nbParts+0.5\n\n' on calcule le quotient familial et le revenu imposable\nDim revenu, qf\nrevenu=0.72*salaire\nqf=revenu/nbParts\n\n' on calcule l'imp\u00f4t\nDim i, impot\ni=0\nDo While i&lt;ubound(limites) And qf&gt;limites(i)\ni=i+1\nLoop\nimpot=int(revenu*coeffr(i)-nbParts*coeffn(i))\n\n' on affiche le r\u00e9sultat\nwscript.echo \"imp\u00f4t=\" &amp; impot\n\n' on quitte sans erreur\nwscript.quit 0\n</code></pre> <p>R\u00e9sultats</p> <pre><code>C:\\&gt;cscript impots1.vbs o 2 200000\n\nimp\u00f4t=22504\n\nC:\\&gt;cscript impots1.vbs o 2 20000\n\nimp\u00f4t=0\n\nC:\\&gt;cscript impots1.vbs o 2 2000000\n\nimp\u00f4t=746064\n\nC:\\&gt;cscript impots1.vbs n 2 200000\n\nimp\u00f4t=33388\n\nC:\\&gt;cscript impots1.vbs n 3 200000\n\nimp\u00f4t=22504\n\nC:\\&gt;cscript impots1.vbs\n\nSyntaxe : pg mari\u00e9 enfants salaire\nmari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\nenfants : nombre d'enfants\nsalaire : salaire annuel sans les centimes\n</code></pre> <p>Commentaires :</p> <ul> <li>le programme utilise ce qui a \u00e9t\u00e9 expos\u00e9 pr\u00e9c\u00e9demment (d\u00e9claration des variables, arguments, changements de types, tests, boucles, tableau dans un variant)</li> <li>il ne v\u00e9rifie pas la validit\u00e9 des donn\u00e9es, ce qui serait anormal dans un programme r\u00e9el</li> <li>seule la boucle while pr\u00e9sente une difficult\u00e9. Elle cherche \u00e0 d\u00e9terminer l'indice i du tableau limites pour lequel on a limites(i)&gt;qf et cela pour i&lt;ubound(limites) (c.a.d. ici i&lt;13) car le dernier \u00e9l\u00e9ment du tableau limites n'est pas significatif.  Il a \u00e9t\u00e9 ajout\u00e9 uniquement pour que le test [Do While i&lt;ubound(limites) And qf&gt;limites(i)] puisse se faire pour i=13. Le test est alors 13&lt;13 and qf&gt;limites(13) et il faut alors (en vbscript) que limites(13) existe. Lorsqu'on sort de la boucle while, la derni\u00e8re valeur de i calcul\u00e9e permet de calculer l'imp\u00f4t : [impot=int(revenu*coeffr(i)-nbParts*coeffn(i))].</li> </ul>"},{"location":"les-contextes-dx27execution-de-vbscript.html","title":"2. Les contextes d'ex\u00e9cution de VBSCRIPT","text":""},{"location":"les-contextes-dx27execution-de-vbscript.html#21-introduction","title":"2.1. Introduction","text":"<p>Un programme vbscript ne s'ex\u00e9cute pas directement sous Windows mais dans un conteneur qui lui fournit un contexte d'ex\u00e9cution et un certain nombre d'objets qui lui sont propres. Par ailleurs, le programme vbscript peut utiliser des objets mis \u00e0 sa disposition par le syst\u00e8me Windows, objets appel\u00e9s objets ActiveX.</p> <p>Dans ce document, nous utiliserons deux conteneurs : Windows Scripting Host appel\u00e9 couramment WSH et le navigateur Internet Explorer appel\u00e9 parfois par la suite IE. Il en existe bien d'autres. Ainsi, les applications MS-Office sont des conteneurs pour un d\u00e9riv\u00e9 de VB appel\u00e9 VBA (Visual Basic pour Applications). Il existe par ailleurs de nombreuses applications windows qui permettent \u00e0 leurs utilisateurs de d\u00e9passer les limites de celle-ci en leur permettant de d\u00e9velopper des programmes s'ex\u00e9cutant au sein de l'application et utilisant les objets propres \u00e0 celle-ci.</p> <p>Le conteneur dans lequel s'ex\u00e9cute le programme vbscript joue un r\u00f4le primordial :</p> <ul> <li>les objets mis \u00e0 disposition du programme vbscript par le conteneur changent d'un conteneur \u00e0 l'autre. Ainsi WSH met \u00e0 disposition d'un programme vbs un objet appel\u00e9 WScript qui donne acc\u00e8s, par exemple, aux partages et imprimantes r\u00e9seau de la machine h\u00f4te. IE lui, met \u00e0 disposition du programme vbs, un objet appel\u00e9 document qui repr\u00e9sente la totalit\u00e9 du document HTML visualis\u00e9. Le programme vbs va alors pouvoir agir sur ce document. Excel lui met \u00e0 disposition d'un programme VBA des objets repr\u00e9sentant des classeurs, des feuilles de classeurs, des graphiques, etc.... en fait tous les objets manipul\u00e9s par Excel.</li> <li>si les objets d'un conteneur donnent toute sa puissance \u00e0 un programme vbscript, il peut parfois en limiter certains domaines. Ainsi un programme vbscript ex\u00e9cut\u00e9 dans le navigateur IE ne peut pas acc\u00e9der au disque de la machine h\u00f4te, ceci pour des raisons de s\u00e9curit\u00e9. Donc, lorsqu'on parle de programmation vbscript, il faut indiquer dans quel conteneur le programme est ex\u00e9cut\u00e9.</li> </ul> <p>Sous windows, vbscript n'est pas le seul langage utilisable dans les conteneurs WSH ou IE. On peut par exemple utiliser JScript (=JavaScript), PerlScript (=Perl), Python, ... Nombre de ces langages semblent de prime abord sup\u00e9rieurs \u00e0 vbscript. Mais ce dernier a cependant de s\u00e9rieux atouts :</p> <ul> <li>VB et ses d\u00e9clinaisons VBSCRIPT et VBA sont tr\u00e8s r\u00e9pandues sur les machines windows. Conna\u00eetre ce langage para\u00eet indispensable.</li> <li>C'est davantage les objets utilisables par un programme que le langage utilis\u00e9 par celui-ci qui font sa puissance. Or nombre de ces objets sont fournis par les conteneurs et non par les langages eux-m\u00eames. Un inconv\u00e9nient de VBSCRIPT est qu'il n'est pas portable sur un syst\u00e8me autre que Windows, par exemple Unix. Ses concurrents Javascript, Perl, Python eux le sont. Si on doit travailler sur des syst\u00e8mes h\u00e9t\u00e9rog\u00e8nes, il peut \u00eatre int\u00e9ressant voire indispensable d'utiliser le m\u00eame langage sur les diff\u00e9rents syst\u00e8mes.</li> </ul>"},{"location":"les-contextes-dx27execution-de-vbscript.html#22-le-conteneur-wsh","title":"2.2. Le conteneur WSH","text":"<p>Le conteneur WSH (Windows Scripting Host) permet l'ex\u00e9cution, au sein de Windows, de programmes \u00e9crits en divers langages : vbscript, javascript, perlscript, python, ... Il existe une norme \u00e0 respecter pour qu'un langage puisse \u00eatre utilis\u00e9 au sein de WSH. Tout langage respectant cette norme est candidat \u00e0 l'ex\u00e9cution au sein de WSH. On peut imaginer que la liste pr\u00e9c\u00e9dente des langages s'ex\u00e9cutant dans WSH puisse s'allonger. Un conteneur met \u00e0 la disposition des programmes qu'il ex\u00e9cute des objets qui leur donnent leur v\u00e9ritable puissance. Ceci tend \u00e0 gommer les diff\u00e9rences entre langages puiqu'ils utilisent alors tous le m\u00eame ensemble d'objets. Utiliser un langage plut\u00f4t qu'un autre peut devenir alors une simple affaire de go\u00fbt plut\u00f4t que de performances.</p> <p>L'ex\u00e9cution d'un programme dans WSH se fait \u00e0 l'aide de deux ex\u00e9cutables : wscript.exe et cscript.exe. wscript.exe se trouve normalement dans le r\u00e9pertoire d'installation de windows appel\u00e9 g\u00e9n\u00e9ralement %windir% :</p> <pre><code>C:\\ &gt;echo %windir%\nC:\\WINDOWS\n\nC:\\&gt;dir c:\\windows\\wscript.exe\nWSCRIPT  EXE       123 280  19/09/01  11:54 wscript.exe\n\nL'ex\u00e9cutable cscript.exe se trouve lui sous %windir%\\command :\n\nC:\\&gt;dir c:\\windows\\cscript.* /s\n\nR\u00e9pertoire de C:\\WINDOWS\\COMMAND\nCSCRIPT  EXE       102 450  26/06/01  17:49 cscript.exe\n</code></pre> <p>Le w de wscript veut dire windows et le c de cscript veut dire console. Un script peut \u00eatre ex\u00e9cut\u00e9 indiff\u00e9remment par wscript ou cscript. La diff\u00e9rence r\u00e9side dans le mode d'affichage de messages \u00e0 l'\u00e9cran :</p> <ul> <li>wscript les affiche dans une fen\u00eatre</li> <li>cscript les affiche \u00e0 l'\u00e9cran Voici un script coucou.vbs qui affiche coucou \u00e0 l'\u00e9cran :</li> </ul> <p></p> <p>Ouvrons une fen\u00eatre DOS et ex\u00e9cutons-le successivement avec wscript et cscript :</p> <pre><code>DOS&gt;wscript coucou.vbs\n</code></pre> <p></p> <pre><code>DOS&gt;cscript coucou.vbs\n\nMicrosoft (R) Windows Script Host Version 5.6\nCopyright (C) Microsoft Corporation 1996-2001. Tous droits r\u00e9serv\u00e9s.\n\ncoucou\n</code></pre> <p>On voit ci-dessus clairement la diff\u00e9rence entre les deux modes. Dans ce document, nous utiliserons quasi exclusivement le mode console cscript. C'est le mode qui convient aux applications dites \"batch\" c'est \u00e0 dire des applications sans interaction avec un utilisateur au clavier. On notera deux points dans les r\u00e9sultats pr\u00e9c\u00e9dents :</p> <ul> <li> <p>On a suppos\u00e9 que les ex\u00e9cutables wscript.exe et cscript.exe \u00e9taient tous les deux dans le \"PATH\" de la machine, ce qui permet de les lancer en tapant simplement leurs noms. Si ce n'\u00e9tait pas le cas, il aurait fallu \u00e9crire ici : <pre><code>DOS&gt;c:\\windows\\wscript coucou.vbs\nDOS&gt;c:\\windows\\command\\cscript coucou.vbs\n</code></pre></p> </li> <li> <p>On notera que la version de wsh utilis\u00e9e dans cet exemple et dans la suite du document est la version 5.6.</p> </li> <li>Le fichier source du script a le suffixe .vbs. C'est le suffixe d\u00e9signant un script vbscript, un script javascript \u00e9tant lui d\u00e9sign\u00e9 par le suffixe .js. Le programme cscript a diverses options de lancement qu'on obtient en lan\u00e7ant cscript sans arguments :</li> </ul> <pre><code>DOS&gt;cscript\n\nMicrosoft (R) Windows Script Host Version 5.6\nCopyright (C) Microsoft Corporation 1996-2001. Tous droits r\u00e9serv\u00e9s.\n\nUtilisation : CScript scriptname.extension [option...] [arguments...]\n\nOptions:\n//B         batch : Supprime l'affichage des invites et des erreurs de scripts\n//D         Activer le d\u00e9bogage\n//E:engine  Utiliser le moteur pour l'ex\u00e9cution de script\n//H:CScript Remplace l'environnement d'ex\u00e9cution de scripts par d\u00e9faut par CScript.exe\n//H:WScript tRemplace l'environnement d'ex\u00e9cution de scripts par d\u00e9faut par WScript.exe (default)\n//I         Mode interactif (par d\u00e9faut, contraire de l'option  //B)\n//Job :xxxx    Ex\u00e9cuter une t\u00e2che WSF\n//Logo      Afficher un logo (default)\n//Nologo    Emp\u00eacher l'affichage d'un logo : Aucune banni\u00e8re ne s'affiche pendant la dur\u00e9e d'ex\u00e9cution\n//S         Enregistrer les options de ligne de commande actuelles pour cet utilisateur\n//T:nn      Dur\u00e9e d'ex\u00e9cution en secondes :  Temps maximal autoris\u00e9 pour l'ex\u00e9cution d'un script\n//X         Ex\u00e9cuter un script dans le d\u00e9bogueur\n</code></pre> <p>L'argument //nologo supprime l'affichage de la banni\u00e8re de wsh :</p> <pre><code>C:\\&gt;cscript //nologo coucou.vbs\ncoucou\n</code></pre>"},{"location":"les-contextes-dx27execution-de-vbscript.html#23-la-forme-dun-script-wsh","title":"2.3. La forme d'un script WSH","text":"<p>Nous venons de voir un premier script : coucou.vbs</p> <p></p> <p>Nous avons indiqu\u00e9 que le suffixe .vbs du fichier d\u00e9signait un script vbscript. Ce n'est pas une obligation. Nous aurions pu mettre le script dans un fichier de suffixe .wsf sous la forme suivante plus complexe :</p> <p></p> <p>L'ex\u00e9cution de ce script donne la chose suivante :</p> <pre><code>C:\\&gt;cscript //nologo coucou2.wsf\ncoucou\n</code></pre> <p>Un script WSH peut m\u00e9langer les langages :</p> <p></p> <p>L'ex\u00e9cution de ce script donne la chose suivante :</p> <pre><code>C:\\&gt;cscript //nologo coucou3.wsf\ncoucou (vbscript)\ncoucou (javascript)\ncoucou (perlscript)\n</code></pre> <p>Nous retiendrons les points suivants :</p> <ul> <li>Le conteneur WSH n'est pas li\u00e9 \u00e0 un langage. Un script wsh peut m\u00e9langer les langages dans un fichier de suffixe .wsf</li> <li>Le script est alors encadr\u00e9 par des balises &lt;job id=\"...\"&gt; ... &lt;/job&gt;</li> <li>A l'int\u00e9rieur de l'application (=job), les langages utilis\u00e9s par les diff\u00e9rentes portions de code sont balis\u00e9es par &lt;script language=\"....\"&gt; .... &lt;/script&gt;</li> <li>Ce langage de balisages porte un nom : XML pour eXtended Markup Language. XML ne d\u00e9finit aucune balise mais des r\u00e8gles d'agencement de balises. Ici on devrait donc dire que le langage de balisages utilis\u00e9 dans un script wsh suit la norme XML. Par la suite, nous utiliserons exclusivement vbscript dans des fichiers .vbs.</li> </ul>"},{"location":"les-contextes-dx27execution-de-vbscript.html#24-lobjet-wscript","title":"2.4. L'objet WSCRIPT","text":"<p>Le conteneur WSH met \u00e0 la disposition des scripts qu'il ex\u00e9cute un objet appel\u00e9 wscript. Un objet a des propri\u00e9t\u00e9s et des m\u00e9thodes :</p> <p>Un objet Obj a des propri\u00e9t\u00e9s Pi qui fixent son \u00e9tat. Ainsi un objet thermom\u00e8tre peut avoir une propri\u00e9t\u00e9 temp\u00e9rature. Cette propri\u00e9t\u00e9 est un des aspects de l'\u00e9tat du thermom\u00e8tre. Une autre pourrait \u00eatre la temp\u00e9rature maximale Tmax qu'il peut supporter.</p> <p>L'objet Obj peut avoir des m\u00e9thodes Mj qui permettent \u00e0 des agents ext\u00e9rieurs soit de :</p> <ul> <li>conna\u00eetre son \u00e9tat</li> <li>changer son \u00e9tat Ainsi notre thermom\u00e8tre, s'il est \u00e9lectronique, pourrait avoir une m\u00e9thode allumer qui le mettrait en marche, une autre \u00e9teindre qui l'\u00e9teindrait, une autre afficher qui afficherait la temp\u00e9rature d'\u00e9quilibre une fois celle-ci atteinte. En termes de programmation, une m\u00e9thode est une fonction qui peut admettre des arguments et rendre des r\u00e9sultats.</li> </ul> <p>En Vbscript, les propri\u00e9t\u00e9s Pi d'un objet Obj sont not\u00e9es Obj.Pi et les m\u00e9thodes Mj sont not\u00e9es Obj.Mj. L'objet wscript de WSH est un objet important pour les m\u00e9thodes qu'il met \u00e0 disposition des scripts. Ainsi sa m\u00e9thode echo permet d'afficher un message. La syntaxe de cette m\u00e9thode est la suivante :</p> <pre><code>wscript.echo arg1, arg2, ..., argn\n</code></pre> <p>Les valeurs des arguments argi sont alors affich\u00e9es dans une fen\u00eatre (ex\u00e9cution par wscript) ou \u00e0 l'\u00e9cran (ex\u00e9cution par cscript sous DOS).</p>"},{"location":"les-contextes-dx27execution-de-vbscript.html#25-le-conteneur-internet-explorer","title":"2.5. Le conteneur Internet Explorer","text":"<p>Nous avons \u00e9crit plus haut que Internet Explorer pouvait \u00eatre un conteneur pour un script vbscript. Montrons-le sur un exemple simple. Suit une page HTML (HyperText Markup Language) appel\u00e9e coucou2.htm ne contenant pas de script vbscript.</p> <p>21</p> <p></p> <p>Son chargement direct par Internet Explorer (Fichier/Ouvrir) donne les r\u00e9sultats suivants :</p> <p>Le contenu du fichier coucou2.htm nous montre que HTML est un langage de balisage. Conna\u00eetre le langage HTML c'est conna\u00eetre ces balises. Celles-ci ont pour but principal d'indiquer au navigateur comment afficher un document. HTML ne suit pas exactement la norme XML mais en est proche.</p> <p>Dans coucou2.htm, il y a deux informations \u00e0 repr\u00e9senter not\u00e9es 1 et 2. Nous les avons repr\u00e9sent\u00e9es \u00e9galement dans l'affichage qui en a \u00e9t\u00e9 fait. C'est la balise &lt;title&gt;...&lt;/title&gt; qui a fait que l'information 1 a \u00e9t\u00e9 plac\u00e9e dans la barre de titre du navigateur et la balise &lt;body&gt;..&lt;/body&gt; qui a fait que l'information 2 a \u00e9t\u00e9 plac\u00e9e dans la partie document du navigateur.</p> <p>Nous n'entrerons pas davantage dans l'\u00e9tude du langage HTML. Modifions le fichier coucou2.htm en y introduisant un script vbscript et appelons-le maintenant coucou1.htm :</p> <p></p> <p>Le script vbscript a \u00e9t\u00e9 plac\u00e9 dans la balise &lt;head&gt;...&lt;/head&gt;. Il aurait pu \u00eatre plac\u00e9 ailleurs. Il affiche \"coucou\" au chargement initial de la page. Ici, le navigateur doit \u00eatre Internet Explorer car seul ce navigateur est par d\u00e9faut un conteneur pour des scripts vbscript. L'affichage obtenu est alors le suivant :</p> <p></p> <p>suivi de l'affichage normal de la page :</p> <p></p> <p>Le script ex\u00e9cut\u00e9 \u00e9tait le suivant :</p> <p></p> <p>Alors que le conteneur WSH mettait \u00e0 disposition du script un objet appel\u00e9 wscript permettant de faire des affichages avec sa m\u00e9thode echo, ici IE met \u00e0 disposition du script un objet window permettant de faire des affichages avec la m\u00e9thode alert. Ainsi pour afficher \"coucou\", on \u00e9crit wscript.echo \"coucou\" dans WSH et window.alert \"coucou\" dans IE. On peut montrer ici aussi qu'en fait on peut utiliser plusieurs langages dans le conteneur IE. Nous reprenons l'exemple d\u00e9j\u00e0 pr\u00e9sent\u00e9 dans WSH au sein d'une page coucou3.htm :</p> <p></p> <p>Le chargement de cette page par IE affiche tout d'abord trois fen\u00eatres d'information :</p> <p>avant d'afficher la page finale :</p> <p></p>"},{"location":"les-contextes-dx27execution-de-vbscript.html#26-laide-de-wsh","title":"2.6. L'aide de WSH","text":"<p>WSH vient avec un syst\u00e8me d'aide situ\u00e9 habituellement dans le dossier \"C:\\Program Files\\Microsoft Windows Script\\ScriptDocs\". pour la version 5.6 de WSH, le fichier d'aide s'appelle \"SCRIPT56.CHM\". Il suffit de double-cliquer sur ce fichier pour avoir acc\u00e8s \u00e0 l'aide. Il peut \u00eatre pratique d'en avoir un raccourci sur son bureau.</p> <p>Une fois lanc\u00e9, on a quelque chose comme suit :</p> <p></p> <p>On y trouve l'aide du conteneur WSH mais \u00e9galement celle pour les langages vbscript et javascript. C'est un outil indispensable \u00e0 la fois pour le d\u00e9butant et le programmeur confirm\u00e9. Il y a plusieurs fa\u00e7ons de travailler avec cette aide :</p> <ul> <li>on ne sait pas trop ce qu'on cherche. On veut simplement d\u00e9couvrir ce qui est propos\u00e9. L'onglet Sommaire ci-dessus peut \u00eatre alors utilis\u00e9. On peut par exemple regarder ce qui est propos\u00e9 pour vbscript :</li> </ul> <p></p> <p>Vous d\u00e9couvrirez dans l'aide de VBscript de nombreuses informations qui ne sont pas dans ce document.</p> <ul> <li>vous pouvez chercher quelque chose de pr\u00e9cis, par exemple la fa\u00e7on d'utiliser la fonction msgbox de VBscript. Utilisez alors l'onglet Rechercher :</li> </ul> <p></p> <p>L'aide ram\u00e8ne toutes les rubriques qui ont un rapport avec le mot recherch\u00e9. En g\u00e9n\u00e9ral, les premi\u00e8res rubriques propos\u00e9es sont les plus pertinentes. C'est le cas ici o\u00f9 la premi\u00e8re rubrique propos\u00e9e est la bonne. Il suffit de double-cliquer dessus pour avoir l'information de cette rubrique :</p> <p></p>"},{"location":"les-fichiers-texte.html","title":"6. Les fichiers texte","text":"<p>Un fichier texte est un fichier contenant des lignes de texte. Examinons la cr\u00e9ation et l'utilisation de tels fichiers sur des exemples.</p>"},{"location":"les-fichiers-texte.html#61-creation-et-utilisation","title":"6.1. Cr\u00e9ation et utilisation","text":"<p>Programme</p><p>R\u00e9sultats</p> <pre><code>C:\\&gt;cscript fic1.vbs\n\nC:\\&gt;dir\n\n FIC1     VBS           352  07/01/02   7:07 fic1.vbs\nTESTFILE TXT            25  07/01/02   7:07 testfile.txt\n\nC:\\&gt;more testfile.txt\n\nCeci est un autre test.\n</code></pre> <p>Commentaires</p> <ul> <li>la ligne 7 cr\u00e9e un objet fichier de type \"Scripting.FileSystemObject\" par la fonction CreateObject(\"Scripting.FileSystemObject\"). Un tel objet permet l'acc\u00e8s \u00e0 tout fichier du syst\u00e8me pas simplement \u00e0 des fichiers texte.</li> <li>la ligne 9 cr\u00e9e un objet \"TextStream\". La cr\u00e9ation de cet objet est associ\u00e9e \u00e0 la cr\u00e9ation du fichier testfile.txt. Ce fichier n'est pas d\u00e9sign\u00e9 par un nom absolu du genre c:\\dir1\\dir2....\\testfile.txt mais par un nom relatif testfile.txt. Il sera alors cr\u00e9\u00e9 dans le r\u00e9pertoire d'o\u00f9 sera lanc\u00e9e la commande d'ex\u00e9cution du fichier.</li> <li>le syst\u00e8me de fichiers du syst\u00e8me windows n'a pas connaissance de concepts tels que fichier texte ou fichier non texte. Il ne conna\u00eet que des fichiers. C'est donc au programme qui exploite ce fichier de savoir s'il va le traiter comme un fichier texte ou non.</li> <li>La ligne 9 cr\u00e9e un objet d'o\u00f9 la commande set utilis\u00e9e pour l'affectation. La cr\u00e9ation d'un objet fichier texte passe par la cr\u00e9ation de 2 objets :</li> <li>la cr\u00e9ation d'un objet Scripting.FileSystemObject (ligne 7)</li> <li>puis par la cr\u00e9ation d'un objet \"TextStream\" (fichier texte) par la m\u00e9thode OpenTextFile de l'objet Scripting.FileSystemObject qui admet plusieurs param\u00e8tres :</li> <li>le nom du fichier \u00e0 g\u00e9rer (obligatoire)</li> <li>le mode d'utilisation du fichier. C'est un entier avec 3 valeurs possibles :</li> <li>1 : utilisation du fichier en lecture</li> <li>2 : utilisation du fichier en \u00e9criture. S'il n'existe pas d\u00e9j\u00e0 et si le 3i\u00e8me param\u00e8tre est pr\u00e9sent et a la valeur true, il est cr\u00e9\u00e9 sinon il n'est pas. S'il existe d\u00e9j\u00e0, il est \u00e9cras\u00e9.</li> <li>8 : utilisation du fichier en ajout, c.a.d. \u00e9criture en fin de fichier. Si le fichier n'existe pas d\u00e9j\u00e0 et si le 3i\u00e8me param\u00e8tre est pr\u00e9sent et a la valeur true, il est cr\u00e9\u00e9 sinon il n'est pas.</li> <li>la ligne 11 \u00e9crit une ligne de texte avec la m\u00e9thode WriteLine de l'objet TextStream cr\u00e9\u00e9.</li> <li>la ligne 13 \"ferme\" le fichier. On ne peut alors plus \u00e9crire ou lire dedans.</li> <li>la ligne 16 cr\u00e9e un nouvel objet \"TextStream\" pour exploiter le m\u00eame fichier que pr\u00e9c\u00e9demment mais cette fois-ci en mode \"ajout\". Les lignes qui seront \u00e9crites le seront derri\u00e8re les lignes existantes.</li> <li>la ligne 18 \u00e9crit deux nouvelles lignes sachant que la constante vbCRLF est la marque de fin de ligne des fichiers texte.</li> <li>la ligne 20 ferme de nouveau le fichier</li> <li>la ligne 23 le rouvre en mode \"lecture\" : on va lire le contenu du fichier. </li> <li>La ligne 27 lit une ligne de texte avec la m\u00e9thode ReadLine de l'objet TextStream. Lorsque le fichier vient d'\u00eatre \"ouvert\", on est positionn\u00e9 sur la 1\u00e8re ligne de texte de celui-ci. Lorsque celle-ci a \u00e9t\u00e9 lue par la m\u00e9thode ReadLine, on est positionn\u00e9 sur la seconde ligne. Ainsi la m\u00e9thode Readline non seulement lit la ligne courante mais \"avance\" ensuite automatiquement \u00e0 la ligne suivante.</li> <li>Pour ligne toutes les lignes de texte, la m\u00e9thode ReadLine doit \u00eatre appliqu\u00e9e de fa\u00e7on r\u00e9p\u00e9t\u00e9e dans une boucle. Celle-ci (ligne 26) se termine lorsque l'attribut AtEndOfStream de l'objet TextStream a la valeur true. Cela signifie alors qu'il n'y a plus de lignes \u00e0 lire dans le fichier.</li> </ul>"},{"location":"les-fichiers-texte.html#62-les-cas-derreur","title":"6.2. Les cas d'erreur","text":"<p>On rencontre deux cas d'erreur fr\u00e9quents :</p> <ul> <li>ouverture en lecture d'un fichier qui n'existe pas</li> <li>ouverture en \u00e9criture ou ajout d'un fichier qui n'existe pas avec comme le troisi\u00e8me param\u00e8tre \u00e0 false dans l'appel \u00e0 la m\u00e9thode OpenTextFile. Le programme suivant montre comment d\u00e9tecter ces erreurs :</li> </ul> <p>Programme</p> <pre><code>' cr\u00e9ation &amp; remplissage d'un fichier texte\nOption Explicit\nDim objFichier,MyFile\nConst ForReading = 1, ForWriting = 2, ForAppending = 8\nDim codeErreur\n\n' on cr\u00e9e un objet fichier\nSet objFichier=CreateObject(\"Scripting.FileSystemObject\")\n\n' on ouvre un fichier texte devant exister en lecture\nOn Error Resume Next\nSet MyFile= objFichier.OpenTextFile(\"abcd\", ForReading)\ncodeErreur=err.number\nOn Error GoTo 0\nIf codeErreur&lt;&gt;0 Then  \n  ' le fichier n'existe pas\n  wscript.echo \"Le fichier [abcd] n'existe pas\"\nElse\n  ' on ferme le fichier texte  \n  MyFile.Close\nEnd If\n\n\n' on ouvre un fichier texte devant exister en \u00e9criture\nOn Error Resume Next\nSet MyFile= objFichier.OpenTextFile(\"abcd\", ForWriting, False)\ncodeErreur=err.number\nOn Error GoTo 0\nIf codeErreur&lt;&gt;0 Then  \n  wscript.echo \"Le fichier [abcd] n'existe pas\"\nElse\n  ' on ferme le fichier texte\n  MyFile.Close\nEnd If\n\n' on ouvre un fichier texte devant exister en ajout\nOn Error Resume Next\nSet MyFile= objFichier.OpenTextFile(\"abcd\", ForAppending, False)\ncodeErreur=err.number\nOn Error GoTo 0\nIf codeErreur&lt;&gt;0 Then  \n  wscript.echo \"Le fichier [abcd] n'existe pas\"\nElse\n  ' on ferme le fichier texte\n  MyFile.Close\nEnd If\n\n' fin\nwscript.quit 0\n</code></pre> <p>R\u00e9sultats</p> <pre><code>C:\\&gt;dir\n\nFIC1     VBS           964  07/01/02   7:54 fic1.vbs\nTESTFILE TXT             0  07/01/02   8:18 testfile.txt\nFIC2     VBS         1 252  07/01/02   8:23 fic2.vbs\n         3 fichier(s)              2 216 octets\n         2 r\u00e9pertoire(s)        4 007.11 Mo libre\n\nC:\\&gt;cscript fic2.vbs\n\nLe fichier [abcd] n'existe pas\nLe fichier [abcd] n'existe pas\nLe fichier [abcd] n'existe pas\n</code></pre>"},{"location":"les-fichiers-texte.html#63-lapplication-impots-avec-un-fichier-texte","title":"6.3. L'application IMPOTS avec un fichier texte","text":"<p>Nous reprenons l'application de calcul de l'imp\u00f4t en supposant que les donn\u00e9es n\u00e9cessaires au calcul de l'imp\u00f4t sont dans un fichier texte appel\u00e9 data.txt :</p> <pre><code>12620 13190 15640 24740 31810 39970 48360 55790 92970 127860 151250 172040 195000 0\n0 0,05 0,1 0,15 0,2 0,25 0,3 0,35 0,4 0,45 0,5 0,55 0,6 0,65\n0 631 1290,5 2072,5 3309,5 4900 6898,5 9316,5 12106 16754,5 23147,5 30710 39312 49062\n</code></pre> <p>Les trois lignes contiennent respectivement les donn\u00e9es des tableaux limites, coeffR et coeffN de l'application. Gr\u00e2ce \u00e0 la modularisation de notre application, les modifications interviennent essentiellement dans la proc\u00e9dure getData charg\u00e9e de construire les trois tableaux. Le nouveau programme est le suivant :</p> <p>Programme</p> <pre><code>' calcul de l'imp\u00f4t d'un contribuable\n' le programme doit \u00eatre appel\u00e9 avec trois param\u00e8tres : mari\u00e9 enfants salaire\n' mari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\n' enfants : nombre d'enfants\n' salaire : salaire annuel sans les centimes\n\n' d\u00e9claration obligatoire des variables\n  Option Explicit\n  Dim erreur\n\n' on r\u00e9cup\u00e8re les arguments en v\u00e9rifiant leur validit\u00e9\n  Dim marie, enfants, salaire\n  erreur=getArguments(marie,enfants,salaire)\n  ' erreur ?\n  If erreur(0)&lt;&gt;0 Then wscript.echo erreur(1) : wscript.quit erreur(0)\n\n' on r\u00e9cup\u00e8re les donn\u00e9es n\u00e9cessaires au calcul de l'imp\u00f4t\n  Dim limites, coeffR, coeffN\n  erreur=getData(limites,coeffR,coeffN)\n  ' erreur ?\n  If erreur(0)&lt;&gt;0 Then wscript.echo erreur(1) : wscript.quit 5\n\n  ' on affiche le r\u00e9sultat\n  wscript.echo \"imp\u00f4t=\" &amp; calculerImpot(marie,enfants,salaire,limites,coeffR,coeffN)\n\n  ' on quitte sans erreur\n  wscript.quit 0\n\n' ------------ fonctions et proc\u00e9dures\n\n' ----------- getArguments\nFunction getArguments(byref marie, ByRef enfants, ByRef salaire)\n  ' doit r\u00e9cup\u00e9rer trois valeurs pass\u00e9es comme argument au programme principal\n  ' un argument est transmis au programme sans espaces devant et derri\u00e8re\n  ' on utilisera des expression r\u00e9guli\u00e8res pour v\u00e9rifier la validit\u00e9 des donn\u00e9es\n\n  ' rend un variant tableau erreur \u00e0 2 valeurs\n  ' erreur(0) : code d'erreur, 0 si pas d'erreur\n  ' erreur(1) : message d'erreur si erreur sinon la cha\u00eene vide\n\n  Dim syntaxe\n  syntaxe= _\n    \"Syntaxe : pg mari\u00e9 enfants salaire\" &amp; vbCRLF &amp; _\n    \"mari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\" &amp; vbCRLF &amp; _\n    \"enfants : nombre d'enfants (entier &gt;=0)\" &amp; vbCRLF &amp; _\n    \"salaire : salaire annuel sans les centimes (entier &gt;=0)\"\n\n' on v\u00e9rifie qu'il y a 3 arguments\n  Dim nbArguments\n  nbArguments=wscript.arguments.count\n  If nbArguments&lt;&gt;3 Then\n    ' msg d'erreur\n    getArguments= array(1,syntaxe &amp; vbCRLF &amp; vbCRLF &amp; \"erreur : nombre d'arguments incorrect\")\n    ' fin\n    Exit Function\n  End If\n\n  Dim modele, correspondances\n  Set modele=new regexp\n\n  ' le statut marital doit \u00eatre parmi les caract\u00e8res oOnN\n  modele.pattern=\"^[oOnN]$\"\n  Set correspondances=modele.execute(wscript.arguments(0))\n  If correspondances.count=0 Then\n    ' msg d'erreur\n    getArguments=array(2,syntaxe &amp; vbCRLF &amp; vbCRLF &amp; \"erreur : argument marie incorrect\")\n    ' on quitte\n    Exit Function\n  End If\n  ' on r\u00e9cup\u00e8re la valeur\n  If lcase(wscript.arguments(0)) = \"o\"Then\n    marie=true\n  Else\n    marie=false\n  End If\n\n  ' enfants doit \u00eatre un nombre entier &gt;=0\n  modele.pattern=\"^\\d{1,2}$\"\n  Set correspondances=modele.execute(wscript.arguments(1))\n  If correspondances.count=0 Then\n    ' erreur\n    getArguments= array(3,syntaxe &amp; vbCRLF &amp; vbCRLF &amp; \"erreur : argument enfants incorrect\")\n    ' on quitte\n    Exit Function\n  End If\n  ' on r\u00e9cup\u00e8re la valeur\n  enfants=cint(wscript.arguments(1))\n\n  ' salaire doit \u00eatre un entier &gt;=0\n  modele.pattern=\"^\\d{1,9}$\"\n  Set correspondances=modele.execute(wscript.arguments(2))\n  If correspondances.count=0 Then\n    ' erreur\n    getArguments= array(4,syntaxe &amp; vbCRLF &amp; vbCRLF &amp; \"erreur : argument salaire incorrect\")\n    ' on quitte\n    Exit Function\n  End If\n  ' on r\u00e9cup\u00e8re la valeur\n  salaire=clng(wscript.arguments(2))\n\n  ' c'est fini sans erreur\n  getArguments=array(0,\"\")\nEnd Function\n\n' ----------- getData\nFunction getData(byref limites, ByRef coeffR, ByRef coeffN)\n  ' les donn\u00e9es des trois tableaux limites, coeffR, coeffN sont dans un fichier texte\n  ' appel\u00e9 data.txt. Chaque tableau occupe une ligne sous la forme val1 val2 ... valn\n  ' on trouve dans l'ordre limites, coeffR, coeffN\n\n  ' rend un variant erreur tableau \u00e0 2 \u00e9l\u00e9ments pour g\u00e9rer l'\u00e9ventuelle erreur\n  ' erreur(0) : 0 si pas d'erreur, un nombre entier &gt;0 sinon\n  ' erreur(1) : le message d'erreur si erreur\n\n  Dim objFichier,MyFile,codeErreur\n  Const ForReading = 1, dataFileName=\"data.txt\"\n\n  ' on cr\u00e9e un objet fichier\n  Set objFichier=CreateObject(\"Scripting.FileSystemObject\")\n  ' on ouvre le fichier data.txt en lecture\n  On Error Resume Next\n  Set MyFile= objFichier.OpenTextFile(dataFileName, ForReading)\n  ' erreur ?\n  codeErreur=err.number\n  On Error GoTo 0\n  If codeErreur&lt;&gt;0 Then\n    ' il y a eu erreur - on la note\n    getData=array(1,\"Impossible d'ouvrir le fichier des donn\u00e9es [\" &amp; dataFileName &amp; \"] en lecture\")\n    ' on rentre\n    Exit Function\n  End If\n\n  ' on suppose maintenant que le contenu est correct et on ne fait aucune v\u00e9rification\n  ' on lit les 3 lignes\n\n  ' limites\n  Dim ligne, i\n  ligne=MyFile.ReadLine\n  getDataFromLine ligne,limites\n\n  ' coeffR\n  ligne=MyFile.ReadLine\n  getDataFromLine ligne,coeffR\n\n\n  ' coeffN\n  ligne=MyFile.ReadLine\n  coeffN=split(ligne,\" \")\n  getDataFromLine ligne,coeffN\n\n  ' on ferme le fichier\n  MyFile.close\n\n  ' c'est fini sans erreur\n  getData=array(0,\"\")\nEnd Function\n\n' ----------- getDataFromLine\nSub getDataFromLine(byref ligne, ByRef tableau)\n  ' met dans tableau les valeurs num\u00e9riques contenues dans ligne\n  ' celles-ci sont s\u00e9par\u00e9es par un ou plusieurs espaces\n\n  ' au d\u00e9part le tableau est vide\n  tableau=array()\n  ' on d\u00e9finit un mod\u00e8le pour la ligne\n  Dim modele, correspondances\n  Set modele= New RegExP\n  With modele\n    .pattern=\"\\d+,\\d+|\\d+\"    ' 140,5 ou 140\n    .global=true              ' toutes les valeurs\n  End With\n\n  ' on analyse la ligne\n  Set correspondances=modele.execute(ligne)\n  Dim i\n  For i=0 To correspondances.count-1\n    ' on redimensionne le tableau\n    ReDim Preserve tableau(i)\n    ' on affecte une valeur au nouvel \u00e9l\u00e9ment\n    tableau(i)=cdbl(correspondances(i).value)\n  Next\n\n  'fin\nEnd Sub\n\n\n\n\n' ----------- calculerImpot\nFunction calculerImpot(byval marie,ByVal enfants,ByVal salaire, ByRef limites, ByRef coeffR, ByRef coeffN)\n\n  ' on calcule le nombre de parts\n  Dim nbParts\n  If marie=true Then\n    nbParts=(enfants/2)+2\n  Else\n    nbParts=(enfants/2)+1\n  End If\n  If enfants&gt;=3 Then nbParts=nbParts+0.5\n\n  ' on calcule le quotient familial et le revenu imposable\n  Dim revenu, qf\n  revenu=0.72*salaire\n  qf=revenu/nbParts\n\n  ' on calcule l'imp\u00f4t\n  Dim i, impot\n  i=0\n  Do While i&lt;ubound(limites) And qf&gt;limites(i)\n    i=i+1\n  Loop\n  calculerImpot=int(revenu*coeffr(i)-nbParts*coeffn(i))\nEnd Function\n</code></pre> <p>Commentaires :</p> <ul> <li>dans le fichier texte data.txt, les valeurs peuvent \u00eatre s\u00e9par\u00e9es par un ou plusieurs espaces, d'o\u00f9 l'impossibilit\u00e9 d'utiliser la fonction split pour r\u00e9cup\u00e9rer les valeurs de la ligne. Il a fallu passer par une expression r\u00e9guli\u00e8re</li> <li>la fonction getData rend, outre les trois tableaux limites, coeffR, coeffN, un r\u00e9sultat indiquant s'il y a eu erreur ou non. Ce r\u00e9sultat est un variant tableau de eux \u00e9l\u00e9ments. Le premier \u00e9l\u00e9ment est un code d'erreur (0 si pas d'erreur), le second le message d'erreur s'il y a eu erreur.</li> <li>la fonction getData ne teste pas la validit\u00e9 des valeurs trouv\u00e9es dans le fichier data.txt. En situation r\u00e9elle, elle devrait le faire.</li> </ul>"},{"location":"les-fonctions-et-procedures.html","title":"5. Les fonctions et proc\u00e9dures","text":""},{"location":"les-fonctions-et-procedures.html#51-les-fonctions-predefinies-de-vbscript","title":"5.1. Les fonctions pr\u00e9d\u00e9finies de vbscript","text":"<p>La richesse d'un langage d\u00e9rive en grande partie de sa biblioth\u00e8que de fonctions, ces derni\u00e8res pouvant \u00eatre encapsul\u00e9es dans des objets sous le nom de m\u00e9thodes. Sous cet aspect, on peut consid\u00e9rer que vbscript est plut\u00f4t pauvre.</p> <p>Le tableau suivant d\u00e9finit les fonctions de VBScript hors objets. Nous ne les d\u00e9taillerons pas. Leur nom est en g\u00e9n\u00e9ral une indication de leur r\u00f4le. Le lecteur consultera la documentation pour avoir des d\u00e9tails sur une fonction particuli\u00e8re.</p> <p>Abs</p><p>Array</p><p>Asc</p><p>Atn</p><p>CBool</p><p>CByte</p><p>CCur</p><p>CDate</p><p>CDbl</p><p>Chr</p><p>CInt</p><p>CLng</p><p>Conversions</p><p>Cos</p><p>CreateObject</p><p>CSng</p><p>Date</p><p>DateAdd</p><p>DateDiff</p><p>DatePart</p><p>DateSerial</p><p>DateValue</p><p>Day</p><p>Derived Maths</p><p>Eval</p><p>Exp</p><p>Filter</p><p>FormatCurrency</p><p>FormatDateTime</p><p>FormatNumber</p><p>FormatPercent</p><p>GetLocale</p><p>GetObject</p><p>GetRef</p><p>Hex</p><p>Hour</p><p>InputBox</p><p>InStr</p><p>InStrRev</p><p>Int, Fixs</p><p>IsArray</p><p>IsDate</p><p>IsEmpty</p><p>IsNull</p><p>IsNumeric</p><p>IsObject</p><p>Join</p><p>LBound</p><p>LCase</p><p>Left</p><p>Len</p><p>LoadPicture</p><p>Log</p><p>LTrim; RTrim; and Trims</p><p>Maths</p><p>Mid</p><p>Minute</p><p>Month</p><p>MonthName</p><p>MsgBox</p><p>Now</p><p>Oct</p><p>Replace</p><p>RGB</p><p>Right</p><p>Rnd</p><p>Round</p><p>ScriptEngine</p><p>ScriptEngineBuildVersion</p><p>ScriptEngineMajorVersion</p><p>ScriptEngineMinorVersion</p><p>Second</p><p>SetLocale</p><p>Sgn</p><p>Sin</p><p>Space</p><p>Split</p><p>Sqr</p><p>StrComp</p><p>String</p><p>Tan</p><p>Time</p><p>Timer</p><p>TimeSerial</p><p>TimeValue</p><p>TypeName</p><p>UBound</p><p>UCase</p><p>VarType</p><p>Weekday</p><p>WeekdayName</p><p>Year</p>"},{"location":"les-fonctions-et-procedures.html#52-programmation-modulaire","title":"5.2. Programmation modulaire","text":"<p>D\u00e9crire la solution programm\u00e9e d'un probl\u00e8me, c'est d\u00e9crire la suite d'actions \u00e9l\u00e9mentaires ex\u00e9cutables par l'ordinateur et capables de r\u00e9soudre le probl\u00e8me. Selon les langages ces op\u00e9rations \u00e9l\u00e9mentaires sont plus ou moins sophistiqu\u00e9es. On trouve par exemple:</p> <pre><code>. lire une donn\u00e9e provenant du clavier ou du disque\n\n. \u00e9crire une donn\u00e9e \u00e0 l&amp;#x27;\u00e9cran, sur imprimante, sur disque, etc\n\n. calculer des expressions\n\n. se d\u00e9placer dans un fichier\n\n. ...\n</code></pre> <p>D\u00e9crire un probl\u00e8me complexe peut n\u00e9cessiter plusieurs milliers de ces instructions \u00e9l\u00e9mentaires et plus. Il est alors tr\u00e8s difficile pour l'esprit humain d'avoir une vue globale d'un programme. Devant cette difficult\u00e9 d'appr\u00e9hender le probl\u00e8me dans sa globalit\u00e9, on le d\u00e9compose alors en sous-probl\u00e8mes plus simples \u00e0 r\u00e9soudre. Consid\u00e9rons le probl\u00e8me suivant : Trier une liste de valeurs num\u00e9riques tap\u00e9es au clavier et afficher la liste tri\u00e9e \u00e0 l'\u00e9cran.</p> <p>On peut dans un premier temps d\u00e9crire la solution sous la forme suivante:</p> <pre><code>  d\u00e9but\n        lire les valeurs et les mettre dans un tableau T\n        trier le tableau T\n        \u00e9crire les valeurs tri\u00e9es du tableau T \u00e0 l'\u00e9cran\n  fin\n</code></pre> <p>On a d\u00e9compos\u00e9 le probl\u00e8me en 3 sous-probl\u00e8mes, plus simples \u00e0 r\u00e9soudre. L'\u00e9criture algorithmique est souvent plus formalis\u00e9e que la pr\u00e9c\u00e9dente et l'algorithme s'\u00e9crira plut\u00f4t:</p> <pre><code>   d\u00e9but\n         lire_tableau(T)\n         trier_tableau(T)\n         \u00e9crire_tableau(T)\n   fin\n</code></pre> <p>o\u00f9 T repr\u00e9sente un tableau. Les op\u00e9rations </p> <pre><code>    . lire_tableau(T)\n    . trier_tableau(T)\n    . \u00e9crire_tableau(T)\n</code></pre> <p>sont des op\u00e9rations non \u00e9l\u00e9mentaires qui doivent \u00eatre d\u00e9crites \u00e0 leur tour par des op\u00e9rations \u00e9l\u00e9mentaires. Ceci est fait dans ce qu'on appelle des modules. La donn\u00e9e T est appel\u00e9e un param\u00e8tre du module. C'est une information que le programme appelant passe au module appel\u00e9 (param\u00e8tre d'entr\u00e9e) ou re\u00e7oit du module appel\u00e9 (param\u00e8tre de sortie). Les param\u00e8tres d'un module sont donc les informations qui sont \u00e9chang\u00e9es entre le programme appelant et le module appel\u00e9.</p> <p>module lire_tableau(T)</p><p>module trier_tableau(T)</p><p>module \u00e9crire_tableau(T)</p> <p>Le module lire_tableau(T) pourrait \u00eatre d\u00e9crit comme suit :</p> <pre><code>d\u00e9but\n    \u00e9crire \"Tapez la suite de valeurs \u00e0 trier sous la forme val1 val2 ... : \"\n    lire valeurs\n    construire tableau T \u00e0 partir de la cha\u00eene valeurs\nfin\n</code></pre> <p>Ici, nous avons suffisamment d\u00e9crit le module lire_tableau. En effet, les trois actions n\u00e9cessaires ont une traduction imm\u00e9diate en vbscript. La derni\u00e8re n\u00e9cessitera l'utilisation de la fonction split. Si vbscript n'avait pas cette fonction, l'action 3 devrait \u00eatre d\u00e9compos\u00e9e \u00e0 son tour en actions \u00e9l\u00e9mentaires ayant un \u00e9quivalent imm\u00e9diat en vbscript.</p> <p>Le module \u00e9crire_tableau(T) pourrait \u00eatre d\u00e9crit comme suit :</p> <pre><code>d\u00e9but\n    construire cha\u00eene texte \"valeur1,valeur2,....\" \u00e0 partir du tableau T\n    \u00e9crire texte\nfin\n</code></pre> <p>Le module \u00e9crire_tableau(T) pourrait \u00eatre d\u00e9crit comme suit (on suppose que les indices des \u00e9l\u00e9ments de T commencent \u00e0 0) :</p> <pre><code>d\u00e9but\n      N&lt;-- indice dernier \u00e9l\u00e9ment du tableau T\n      pour IFIN variant de N \u00e0 1\n      faire\n          //on recherche l'indice IMAX du plus gd \u00e9l\u00e9ment de T\n          // IFIN est l'indice du dernier \u00e9l\u00e9ment de T\n\n          chercher_max(T, IFIN, IMAX) \n\n          // on \u00e9change l'\u00e9l\u00e9ment le plus grand de T avec le dernier \u00e9l\u00e9ment de T\n\n          \u00e9changer (T, IMAX, IFIN)\n\n      finfaire\nFIN\n</code></pre> <p>Ici l'algorithme utilise de nouveau des actions non \u00e9l\u00e9mentaires:</p> <pre><code> . chercher_max(T, IFIN, IMAX)\n . \u00e9changer(T, IMAX, IFIN)\n</code></pre> <p>chercher_max(T, IFIN, IMAX) rend l'indice IMAX de l'\u00e9l\u00e9ment le plus grand du tableau T dont l'indice du dernier \u00e9l\u00e9ment est  IFIN.</p> <p>\u00e9changer(T, IMAX, IFIN) \u00e9change 2 \u00e9l\u00e9ments du tableau T , ceux d'indice IMAX et IFIN.</p> <p>Il faut donc d\u00e9crire les nouvelles op\u00e9rations non \u00e9l\u00e9mentaires.</p> <p>module chercher_max(A, IFIN, IMAX)</p> <pre><code>   d\u00e9but\n        IMAX&lt;--0\n\n        pour i variant de 1 \u00e0 IFIN\n        faire\n           si T[i]&gt;T[IMAX] alors \n             d\u00e9but\n                IMAX&lt;--i\n             fin\n        finfaire\n    fin\n</code></pre> <p>module \u00e9changer(T IMAX, IFIN)</p> <pre><code>  d\u00e9but\n       temp&lt;----T[IMAX]\n       T[IMAX]&lt;---T[IFIN]\n       T[IFIN]&lt;---temp\n  fin\n</code></pre> <p>Le probl\u00e8me initial  a \u00e9t\u00e9 compl\u00e8tement d\u00e9crit \u00e0 l'aide d'op\u00e9rations \u00e9l\u00e9mentaires vbscript et peut donc maintenant faire l'objet d'une traduction dans ce langage. On notera que les actions \u00e9l\u00e9mentaires peuvent diff\u00e9rer d'un langage \u00e0 l'autre et que donc l'analyse d'un probl\u00e8me doit \u00e0 un certain moment tenir compte du langage de programmation utilis\u00e9. Un objet qui existe dans un langage peut ne pas exister dans un autre et modifier alors l'algorithme utilis\u00e9. Ainsi, si un langage avait une fonction de tri, il serait ici absurde de ne pas l'utiliser.</p> <p>Le principe appliqu\u00e9 ici, est celui dit  de l'analyse descendante. Si on repr\u00e9sente l'ossature de la solution, on a la chose suivante :</p> <p>On a une structure en arbre.</p>"},{"location":"les-fonctions-et-procedures.html#53-les-fonctions-et-procedures-vbscript","title":"5.3. Les fonctions et proc\u00e9dures vbscript","text":"<p>Une fois l'analyse modulaire op\u00e9r\u00e9e, le programmeur peut traduire les modules de son algorithme en fonctions ou proc\u00e9dures vbscript. Les fonctions et proc\u00e9dures admettent toutes deux des param\u00e8tres d'entr\u00e9e/sortie mais la fonction rend un r\u00e9sultat qui permet son utilisation dans des expressions alors que la proc\u00e9dure n'en rend pas.</p>"},{"location":"les-fonctions-et-procedures.html#531-declaration-des-fonctions-et-procedures-vbscript","title":"5.3.1. D\u00e9claration des fonctions et proc\u00e9dures vbscript","text":"<p>La d\u00e9claration d'une proc\u00e9dure vbscript est la suivante </p> <pre><code>sub nomProc\u00e9dure([Byref/Byval] param1, [Byref/Byval] param2, ...)\n    instructions\nend sub\n</code></pre> <p>et celle d'une fonction </p> <pre><code>function nomFonction([Byref/Byval] param1, [Byref/Byval] param2, ...)\n    instructions\nend sub\n</code></pre> <p>Pour rendre son r\u00e9sultat, la fonction doit comporter une instruction d'affectation du r\u00e9sultat \u00e0 une variable portant le nom de la fonction :</p> <pre><code>nomFonction=r\u00e9sultat\n</code></pre> <p>L'ex\u00e9cution d'une fonction ou proc\u00e9dure s'arr\u00eate de deux fa\u00e7ons :</p> <ul> <li>\u00e0 la rencontre de l'instruction de fin de fonction (end function) ou fin de proc\u00e9dure (end sub)</li> <li>\u00e0 la rencontre de l'instruction de sortie de fonction (exit function) ou de proc\u00e9dure (exit sub) Pour la fonction, on se rappellera que le r\u00e9sultat doit avoir \u00e9t\u00e9 affect\u00e9 \u00e0 une variable portant le nom de la fonction avant que celle-ci ne se termine par un end function ou exit function.</li> </ul>"},{"location":"les-fonctions-et-procedures.html#532-modes-de-passage-des-parametres-dune-fonction-ou-procedure","title":"5.3.2. Modes de passage des param\u00e8tres d'une fonction ou proc\u00e9dure","text":"<p>Dans la d\u00e9claration des param\u00e8tres d'entr\u00e9e-sortie d'une fonction ou proc\u00e9dure, on pr\u00e9cise le mode (byRef,byVal) de transmission du param\u00e8tre du programme appelant vers le programme appel\u00e9 :</p> <pre><code>sub nomProc\u00e9dure([Byref/Byval] param1, [Byref/Byval] param2, ...)\n\nfunction nomFonction([Byref/Byval] param1, [Byref/Byval] param2, ...)\n</code></pre> <p>Lorsque le mode de transmission byRef ou byVal n'est pas pr\u00e9cis\u00e9, c'est le mode byRef qui est utilis\u00e9.</p> <p>Param\u00e8tres effectifs, param\u00e8tres formels</p> <p>Soit une fonction vbscript d\u00e9finie par</p> <pre><code>function nomFonction([Byref/Byval] paramForm1, [Byref/Byval] paramForm2, ...)\n...\nend function\n</code></pre> <p>Les param\u00e8tres parmamFormi utilis\u00e9s dans la d\u00e9finition de la fonction ou de la proc\u00e9dure sont appel\u00e9s param\u00e8tres formels. La fonction pr\u00e9c\u00e9dente pourra \u00eatre utilis\u00e9e \u00e0 partir du programme principal ou d'un autre module par une instruction du genre :</p> <pre><code>r\u00e9sultat=nomFonction(paramEff1, paramEff2, ...)\n</code></pre> <p>Les param\u00e8tres parmamEffi utilis\u00e9s dans l'appel \u00e0 la fonction ou la proc\u00e9dure sont appel\u00e9s param\u00e8tres effectifs. Lorsque l'ex\u00e9cution de la fonction nomFonction commence, les param\u00e8tres formels re\u00e7oivent les valeurs des param\u00e8tres effectifs correspondants. Les mots cl\u00e9s byRef et byVal fixent le mode de transmission de ces valeurs.</p> <p>Mode de transmission par valeur (byVal)</p> <p>Lorsqu'un param\u00e8tre formel pr\u00e9cise ce mode de transmission, le param\u00e8tre formel et le param\u00e8tre effectif sont alors deux variables diff\u00e9rentes. La valeur du param\u00e8tre effectif est copi\u00e9e dans le param\u00e8tre formel avant ex\u00e9cution de la fonction ou proc\u00e9dure. Si celle-ci modifie la valeur du param\u00e8tre formel au cours de son ex\u00e9cution, cela ne modifie en rien la valeur du param\u00e8tre effectif correspondant. Ce mode de transmission convient bien aux param\u00e8tres d'entr\u00e9e de la fonction ou proc\u00e9dure.</p> <p>Mode de transmission par r\u00e9f\u00e9rence (byRef)</p> <p>Ce mode de transmission est le mode par d\u00e9faut si aucun mode de transmission du param\u00e8tre n'est indiqu\u00e9. Lorsqu'un param\u00e8tre formel pr\u00e9cise ce mode de transmission, le param\u00e8tre formel et le param\u00e8tre effectif correspondant sont une seule et m\u00eame variable. Ainsi si la fonction modifie le param\u00e8tre formel, le param\u00e8tre effectif est \u00e9galement modifi\u00e9. Ce mode de transmission convient bien :</p> <ul> <li>aux param\u00e8tres de sortie car la valeur de ceux-ci doivt \u00eatre transmise au programme appelant</li> <li>aux param\u00e8tres d'entr\u00e9e co\u00fbteux \u00e0 recopier tels les tableaux</li> </ul> <p>Le programme suivant montre des exemples de passage de param\u00e8tres :</p> <p>Programme</p> <pre><code>Sub proc1(byval i, ByRef j, k)\n  ' i est pass\u00e9 par valeur (byval) - le param\u00e8tre effectif et le param\u00e8tre formel sont alors diff\u00e9rents\n  ' j est pass\u00e9 par valeur (byref) - le param\u00e8tre effectif et le param\u00e8tre formel sont alors identiques\n  ' le mode de passage de k n'est pas pr\u00e9cis\u00e9. Par d\u00e9faut, c'est par r\u00e9f\u00e9rence\n  i=i+1\n  j=j+1\n  k=k+1\n  affiche \"dans proc1\",i,j,k\nEnd Sub\n\n Sub affiche(byval msg, ByVal i, ByVal j, ByVal k)\n  ' affiche les valeurs de i et j et k\n  wscript.echo msg &amp; \" i=\" &amp; i &amp; \" j=\" &amp; j &amp; \" k=\" &amp; k\nEnd Sub\n\n\n' ------------- appels aux fonctions et proc\u00e9dures\n\n' init i et j\n  i=4:j=5 : k=6\n\n' v\u00e9rification\n  affiche \"dans programme principal, avant l'appel \u00e0 proc1 :\",i,j,k\n\n' appel proc\u00e9dure proc1\n  proc1 i,j,k\n\n' v\u00e9rification\n  affiche \"dans programme principal, apr\u00e8s l'appel \u00e0 proc1 :\",i,j,k\n\n' fin\n  wscript.quit 0\n</code></pre> <p>R\u00e9sultats</p> <pre><code>dans programme principal, avant l'appel \u00e0 proc1 : i=4 j=5 k=6\ndans proc1 i=5 j=6 k=7\ndans programme principal, apr\u00e8s l'appel \u00e0 proc1 : i=4 j=6 k=7\n</code></pre> <p>Commentaires</p> <ul> <li>Dans un script vbscript, il n'y a pas de place particuli\u00e8re pour les fonctions et les proc\u00e9dures. Elles peuvent \u00eatre n'importe o\u00f9 dans le texte source. En g\u00e9n\u00e9ral, on les regroupe soit au d\u00e9but soit \u00e0 la fin et on fait en sorte que le programme principal constitue un bloc continu.</li> </ul>"},{"location":"les-fonctions-et-procedures.html#533-syntaxe-dappel-des-fonctions-et-procedures","title":"5.3.3. Syntaxe d'appel des fonctions et proc\u00e9dures","text":"<p>Soit une proc\u00e9dure p admettant des param\u00e8tres formels pf1, pf2, ...</p> <ul> <li>l'appel \u00e0 la proc\u00e9dure p se fait sous la forme <pre><code>p pe1, pe2, ...\n</code></pre></li> </ul> <p>sans parenth\u00e8ses autour des param\u00e8tres</p> <ul> <li> <p>si la proc\u00e9dure p n'admet aucun param\u00e8tre, on peut indiff\u00e9remment utiliser l'appel p ou p() et la d\u00e9claration sub p ou sub p() Soit une fonction f admettant des param\u00e8tres formels pf1, pf2, ...</p> </li> <li> <p>l'appel \u00e0 la fonction f se fait sous la forme <pre><code>r\u00e9sultat=f(pe1, pe2, ...)\n</code></pre></p> </li> </ul> <p>les parenth\u00e8ses autour des param\u00e8tres sont obligatoires. Si la fonction f n'admet aucun param\u00e8tre, on peut indiff\u00e9remment utiliser l'appel f ou f() et la d\u00e9claration function f ou function f().</p> <ul> <li> <p>le r\u00e9sultat de la fonction f peut \u00eatre ignor\u00e9 par le programme appelant. La fonction f est alors consid\u00e9r\u00e9e comme une proc\u00e9dure et suit les r\u00e8gles d'appel des proc\u00e9dures. On \u00e9crit alors f pe1, pe2, ... (sans parenth\u00e8ses) pour appeler la fonction f. Si la fonction ou proc\u00e9dure est une m\u00e9thode d'objet, il semblerait que les r\u00e8gles soient quelque peu diff\u00e9rentes et non homog\u00e8nes.</p> </li> <li> <p>ainsi on peut \u00e9crire MyFile.WriteLine \"Ceci est un test.\" ou MyFile.WriteLine(\"Ceci est un test.\") </p> </li> <li> <p>mais si on peut \u00e9crire wscript.echo 4, on ne peut pas \u00e9crire wscript.echo(4). On s'en tiendra aux r\u00e8gles suivantes :</p> </li> <li> <p>pas de parenth\u00e8ses autour des param\u00e8tres d'une proc\u00e9dure ou d'une fonction utilis\u00e9e comme une proc\u00e9dure</p> </li> <li>parenth\u00e8ses autour des param\u00e8tres d'une fonction</li> </ul>"},{"location":"les-fonctions-et-procedures.html#534-quelques-exemples-de-fonctions","title":"5.3.4. Quelques exemples de fonctions","text":"<p>On trouvera ci-dessous quelques exemples de d\u00e9finitions et utilisations de fonctions :</p> <p>Programme</p> <pre><code> Function plusgrandque(byval i, ByVal j)\n  ' rend le bool\u00e9en vrai si i&gt;j, le bool\u00e9en faux sinon\n\n  ' v\u00e9rification des donn\u00e9es\n  If isnumeric(i) And isnumeric(j) Then\n    If i&gt;j Then\n      plusgrandque=true\n    Else\n      plusgrandque=false\n    End If\n  Else\n    wscript.echo \"Arguments (\" &amp; i &amp; \",\" &amp; j &amp; \") erron\u00e9s\"\n    plusgrandque=false\n  End If\n  Exit Function\nEnd Function\n\n Function rendUnTableau(byval n)\n  ' rend un tableau de n \u00e9l\u00e9ments\n  tableau=array()\n  ' v\u00e9rification validit\u00e9 du param\u00e8tre n\n  If isnumeric(n) And n&gt;=1 Then\n    ReDim Preserve tableau(n)\n    For i= 0 To n-1\n      tableau(i)=i\n    Next\n  Else\n    wscript.echo \"Argument [\" &amp; n &amp; \"] erron\u00e9\"\n  End If\n  ' on rend le r\u00e9sultat\n  rendUnTableau=tableau\nEnd Function\n\n Function argumentsVariables(byref arguments)\n  ' arguments est un tableau de nombres dont on rend la somme\n  somme=0\n  For i=0 To ubound(arguments)\n    somme=somme+arguments(i)\n  Next\n  argumentsVariables=somme\nEnd Function\n\n  ' deux fonctions sans param\u00e8tres d\u00e9clar\u00e9es de 2 fa\u00e7ons diff\u00e9rentes\n  Function sansParametres1\n    sansParametres=4\n  End Function\n\n  Function sansParametres2()\n    sansParametres=4\n  End Function\n\n\n' ------------- appels aux fonctions et proc\u00e9dures\n\n' appels fonction plusgrandque\n  wscript.echo \"plusgrandque(10,6)=\" &amp; plusgrandque(10,6)\n  wscript.echo \"plusgrandque(6,10)=\" &amp; plusgrandque(6,10)\n  wscript.echo \"plusgrandque(6,6)=\" &amp; plusgrandque(6,6)\n  wscript.echo \"plusgrandque(6,'a')=\" &amp; plusgrandque(6,\"a\")\n\n' appels \u00e0 la fonction rendUnTableau\n  monTableau=rendUnTableau(10)\n  For i=0 To ubound(monTableau)\n    wscript.echo monTableau(i)\n  Next\n  monTableau=rendUnTableau(-6)\n  For i=0 To ubound(monTableau)\n    wscript.echo monTableau(i)\n  Next\n\n' appels \u00e0 la fonction argumentsVariables\n  wscript.echo \"somme=\" &amp; argumentsVariables(array(-1,2,7,8))\n  wscript.echo \"somme=\" &amp; argumentsVariables(array(-1,10,12))\n\n' appels des fonctions sans param\u00e8tres\n  res=sansParametres1\n  res=sansParametres1()\n  sansParametres1\n  sansParametres1()\n\n  res=sansParametres2\n  res=sansParametres2()\n  sansParametres2\n  sansParametres2()\n\n' fin\n  wscript.quit 0\n</code></pre> <p>R\u00e9sultats</p> <pre><code>plusgrandque(10,6)=Vrai\nplusgrandque(6,10)=Faux\nplusgrandque(6,6)=Faux\nArguments (6,a) erron\u00e9s\nplusgrandque(6,'a')=Faux\n0\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\nArgument [-6] erron\u00e9\nsomme=16\nsomme=21\nsomme=10\n</code></pre> <p>Commentaires</p> <ul> <li>la fonction rendUnTableau montre qu'une fonction peut rendre plusieurs r\u00e9sultats et non un seul. Il suffit qu'elle les place dans un variant tableau et qu'elle rende ce variant comme r\u00e9sultat.</li> <li>inversement la fonction argumentsVariables montre qu'on peut \u00e9crire une fonction qui admet un nombre variable d'arguments. Il suffit l\u00e0 \u00e9galement de les mettre dans un variant tableau et de faire de ce variant un param\u00e8tre de la fonction.</li> </ul>"},{"location":"les-fonctions-et-procedures.html#535-parametre-de-sortie-ou-resultat-dune-fonction","title":"5.3.5. Param\u00e8tre de sortie ou r\u00e9sultat d'une fonction","text":"<p>Supposons que l'analyse d'une application ait montr\u00e9 la n\u00e9cessit\u00e9 d'un module M avec des param\u00e8tres d'entr\u00e9e Ei et des param\u00e8tres de sortie Sj. Rappelons que les param\u00e8tres d'entr\u00e9e sont des informations que le programme appelant donne au programme appel\u00e9 et qu'inversement les param\u00e8tres de sortie sont des informations que le programme appel\u00e9 donne au programme appelant. On a en vbscript plusieurs solutions pour les param\u00e8tres de sortie :</p> <ul> <li>s'il n'y a qu'un seul param\u00e8tre de sortie, on peut en faire le r\u00e9sultat d'une fonction. Il n'y a alors plus de param\u00e8tre de sortie mais simplement un r\u00e9sultat de fonction.</li> <li>s'il y a n param\u00e8tres de sortie, l'un d'entre-eux peut servir de r\u00e9sultat de fonction , les n-1 autres restant des param\u00e8tres de sortie. On peut aussi ne pas utiliser de fonction mais une proc\u00e9dure \u00e0 n param\u00e8tres de sortie. On peut \u00e9galement utiliser une fonction qui rendra un tableau dans lequel on aura plac\u00e9 les n valeurs \u00e0 rendre au programme appelant. On se rappellera que le programme appel\u00e9 rend ses r\u00e9sultats au programme appelant par recopie de valeurs. Cette recopie est \u00e9vit\u00e9e dans le cas de param\u00e8tres de sortie pass\u00e9s par r\u00e9f\u00e9rence. Il y a donc dans cette derni\u00e8re solution un gain de temps.</li> </ul>"},{"location":"les-fonctions-et-procedures.html#54-le-programme-vbscript-de-tri-de-valeurs","title":"5.4. Le programme Vbscript de tri de valeurs","text":"<p>Nous avions commenc\u00e9 la discussion sur la programmation modulaire par l'\u00e9tude algorithmique d'un tri de valeurs num\u00e9riques tap\u00e9es au clavier. Voici la traduction VBScript qui pourrait en \u00eatre faite :</p> <p>Programme</p> <pre><code>' programme principal\nOption Explicit\n\nDim T        ' le tableau de valeurs \u00e0 trier\n\n' lecture des valeurs\nT=lire_tableau\n' tri des valeurs\ntrier_tableau T\n' affichage des valeurs tri\u00e9es\necrire_tableau T\n\n' fin\nwscript.quit 0\n\n' ---------- fonctions &amp; proc\u00e9dures\n\n' -------- lire_tableau\nFunction lire_tableau\n  ' on demande les valeurs\n  wscript.stdout.write \"Tapez les valeurs \u00e0 trier sous la forme val1 val2  ... valn : \"\n  ' on les lit\n  Dim valeurs\n  valeurs=wscript.stdin.readLine\n  ' on les met dans un tableau\n  lire_tableau=split(valeurs,\" \")\nEnd Function\n\n' -------- ecrire_tableau\nSub ecrire_tableau(byref T)\n  ' affiche le contenu du tableau T\n  wscript.echo join(T,\" \")\nEnd Sub\n\n' -------- trier_tableau\nSub trier_tableau (byref T)\n  ' tri le tableau T en ordre croissant\n\n  ' on cherche l'indice imax du tableau T[0..ifin]\n  ' pour \u00e9changer T[imax] avec le dernier \u00e9l\u00e9ment du tableau T[0..ifin]\n  ' ensuite on recommence avec un tableau ayant 1 \u00e9l\u00e9ment de moins\n\n  Dim ifin, imax, temp\n  For ifin=ubound(T) To 1 Step -1\n    ' on cherche l'indice imax du tableau T[0..ifin]\n    imax=chercher_max(T,ifin)\n    ' on l'\u00e9change le max avec le dernier \u00e9l\u00e9ment du tableau T[0..ifin]\n    temp=T(ifin):T(ifin)=T(imax):T(imax)=temp\n  Next\nEnd Sub\n\n' -------- chercher_max\nFunction chercher_max(byRef T, ByVal ifin)\n  ' on cherche l'indice imax du tableau T[0..ifin]\n  Dim i, imax\n  imax=0\n  For i=1 To ifin\n    If cdbl(T(i))&gt;cdbl(T(imax)) Then imax=i\n  Next\n\n  ' On rend le r\u00e9sultat\n  chercher_max=imax\nEnd Function\n</code></pre> <p>R\u00e9sultats</p> <pre><code>Tapez les valeurs \u00e0 trier sous la forme val1 val2  ... valn : 10 9 8 7 6 1\n1 6 7 8 9 10\n</code></pre> <p>Commentaires :</p> <ul> <li>le module \u00e9changer qui avait \u00e9t\u00e9 identifi\u00e9 dans l'algorithme initial n'a pas fait ici l'objet d'un module en vbscript parce que jug\u00e9 trop simple pour faire l'objet d'un module particulier.</li> </ul>"},{"location":"les-fonctions-et-procedures.html#55-le-programme-impots-sous-forme-modulaire","title":"5.5. Le programme IMPOTS sous forme modulaire","text":"<p>Nous reprenons le programme de calcul de l'imp\u00f4t \u00e9crit cette fois sous forme modulaire</p> <p>Programme</p> <pre><code>' calcul de l'imp\u00f4t d'un contribuable\n' le programme doit \u00eatre appel\u00e9 avec trois param\u00e8tres : mari\u00e9 enfants salaire\n' mari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\n' enfants : nombre d'enfants\n' salaire : salaire annuel sans les centimes\n\n' d\u00e9claration obligatoire des variables\n  Option Explicit\n  Dim erreur\n\n' on r\u00e9cup\u00e8re les arguments en v\u00e9rifiant leur validit\u00e9\n  Dim marie, enfants, salaire\n  erreur=getArguments(marie,enfants,salaire)\n  ' erreur ?\n  If erreur(0)&lt;&gt;0 Then wscript.echo erreur(1) : wscript.quit erreur(0)\n\n' on r\u00e9cup\u00e8re les donn\u00e9es n\u00e9cessaires au calcul de l'imp\u00f4t\n  Dim limites, coeffR, coeffN\n  getData limites,coeffR,coeffN\n\n  ' on affiche le r\u00e9sultat\n  wscript.echo \"imp\u00f4t=\" &amp; calculerImpot(marie,enfants,salaire,limites,coeffR,coeffN)\n\n  ' on quitte sans erreur\n  wscript.quit 0\n\n' ------------ fonctions et proc\u00e9dures\n\n' ----------- getArguments\nFunction getArguments(byref marie, ByRef enfants, ByRef salaire)\n  ' doit r\u00e9cup\u00e9rer trois valeurs pass\u00e9es comme argument au programme principal\n  ' un argument est transmis au programme sans espaces devant et derri\u00e8re\n  ' on utilisera des expression r\u00e9guli\u00e8res pour v\u00e9rifier la validit\u00e9 des donn\u00e9es\n\n  ' rend un variant tableau erreur \u00e0 2 valeurs\n  ' erreur(0) : code d'erreur, 0 si pas d'erreur\n  ' erreur(1) : message d'erreur si erreur sinon la cha\u00eene vide\n\n  Dim syntaxe\n  syntaxe= _\n    \"Syntaxe : pg mari\u00e9 enfants salaire\" &amp; vbCRLF &amp; _\n    \"mari\u00e9 : caract\u00e8re O si mari\u00e9, N si non mari\u00e9\" &amp; vbCRLF &amp; _\n    \"enfants : nombre d'enfants (entier &gt;=0)\" &amp; vbCRLF &amp; _\n    \"salaire : salaire annuel sans les centimes (entier &gt;=0)\"\n\n' on v\u00e9rifie qu'il y a 3 arguments\n  Dim nbArguments\n  nbArguments=wscript.arguments.count\n  If nbArguments&lt;&gt;3 Then\n    ' msg d'erreur\n    getArguments= array(1,syntaxe &amp; vbCRLF &amp; vbCRLF &amp; \"erreur : nombre d'arguments incorrect\")\n    ' fin\n    Exit Function\n  End If\n\n  Dim modele, correspondances\n  Set modele=new regexp\n\n  ' le statut marital doit \u00eatre parmi les caract\u00e8res oOnN\n  modele.pattern=\"^[oOnN]$\"\n  Set correspondances=modele.execute(wscript.arguments(0))\n  If correspondances.count=0 Then\n    ' msg d'erreur\n    getArguments=array(2,syntaxe &amp; vbCRLF &amp; vbCRLF &amp; \"erreur : argument marie incorrect\")\n    ' on quitte\n    Exit Function\n  End If\n  ' on r\u00e9cup\u00e8re la valeur\n  If lcase(wscript.arguments(0)) = \"o\"Then\n    marie=true\n  Else\n    marie=false\n  End If\n\n  ' enfants doit \u00eatre un nombre entier &gt;=0\n  modele.pattern=\"^\\d{1,2}$\"\n  Set correspondances=modele.execute(wscript.arguments(1))\n  If correspondances.count=0 Then\n    ' erreur\n    getArguments= array(3,syntaxe &amp; vbCRLF &amp; vbCRLF &amp; \"erreur : argument enfants incorrect\")\n    ' on quitte\n    Exit Function\n  End If\n  ' on r\u00e9cup\u00e8re la valeur\n  enfants=cint(wscript.arguments(1))\n\n  ' salaire doit \u00eatre un entier &gt;=0\n  modele.pattern=\"^\\d{1,9}$\"\n  Set correspondances=modele.execute(wscript.arguments(2))\n  If correspondances.count=0 Then\n    ' erreur\n    getArguments= array(4,syntaxe &amp; vbCRLF &amp; vbCRLF &amp; \"erreur : argument salaire incorrect\")\n    ' on quitte\n    Exit Function\n  End If\n  ' on r\u00e9cup\u00e8re la valeur\n  salaire=clng(wscript.arguments(2))\n\n  ' c'est fini sans erreur\n  getArguments=array(0,\"\")\nEnd Function\n\n' ----------- getData\nSub getData(byref limites, ByRef coeffR, ByRef coeffN)  \n  ' on d\u00e9finit les donn\u00e9es n\u00e9cessaire au calcul de l'imp\u00f4t dans 3 tableaux\n  limites=array(12620,13190,15640,24740,31810,39970,48360, _\n    55790,92970,127860,151250,172040,195000,0)\n  coeffr=array(0,0.05,0.1,0.15,0.2,0.25,0.3,0.35,0.4,0.45, _\n    0.5,0.55,0.6,0.65)\n  coeffn=array(0,631,1290.5,2072.5,3309.5,4900,6898.5,9316.5, _\n    12106,16754.5,23147.5,30710,39312,49062)\nEnd Sub\n\n' ----------- calculerImpot\nFunction calculerImpot(byval marie,ByVal enfants,ByVal salaire, ByRef limites, ByRef coeffR, ByRef coeffN)\n\n  ' on calcule le nombre de parts\n  Dim nbParts\n  If marie=true Then\n    nbParts=(enfants/2)+2\n  Else\n    nbParts=(enfants/2)+1\n  End If\n  If enfants&gt;=3 Then nbParts=nbParts+0.5\n\n  ' on calcule le quotient familial et le revenu imposable\n  Dim revenu, qf\n  revenu=0.72*salaire\n  qf=revenu/nbParts\n\n  ' on calcule l'imp\u00f4t\n  Dim i, impot\n  i=0\n  Do While i&lt;ubound(limites) And qf&gt;limites(i)\n    i=i+1\n  Loop\n  calculerImpot=int(revenu*coeffr(i)-nbParts*coeffn(i))\nEnd Function\n</code></pre> <p>Commentaires</p> <ul> <li>la fonction getArguments permet de r\u00e9cup\u00e9rer les informations (marie, enfants, salaire) du contribuable. Ici, elles sont pass\u00e9es en arguments au programme vbscript. Si cela devait changer, par exemple si ces arguments venaient d'une interface graphique, seule la proc\u00e9dure getArguments devrait \u00eatre r\u00e9\u00e9crite et pas les autres.</li> <li>la fonction getArguments peut d\u00e9tecter des erreurs sur les arguments. Lorsque ceci se produit, on aurait pu d\u00e9cider d'arr\u00eater l'ex\u00e9cution du programme dans la fonction getArguments par une instruction wscript.quit. Ceci ne doit jamais \u00eatre fait dans une fonction ou proc\u00e9dure. Si une fonction ou proc\u00e9dure d\u00e9tecte une erreur, elle doit le signaler d'une fa\u00e7on ou d'une autre au programme appelant. C'est \u00e0 lui de prendre la d\u00e9cision d'arr\u00eater l'ex\u00e9cution ou non, pas \u00e0 la proc\u00e9dure. Dans notre exemple, le programme appelant pourrait d\u00e9cider de redemander \u00e0 l'utilisateur de retaper la donn\u00e9e erron\u00e9e au clavier plut\u00f4t que d'arr\u00eater l'ex\u00e9cution.</li> <li>ici, la fonction getArguments rend un variant tableau o\u00f9 le 1er \u00e9l\u00e9ment est un code d'erreur (0 si pas d'erreur) et le second un message d'erreur si il y a eu erreur. En testant le r\u00e9sultat obtenu, le programme appelant peut savoir s'il y a eu erreur ou non.</li> <li>la proc\u00e9dure getData permet d'obtenir les donn\u00e9es n\u00e9cessaires au calcul de l'imp\u00f4t. Ici elles sont directement d\u00e9finies dans la proc\u00e9dure getData. Si ces donn\u00e9es devaient provenir d'une autre source, d'un fichier ou d'une base de donn\u00e9es par exemple, seule la proc\u00e9dure getData devrait \u00eatre r\u00e9\u00e9crite et pas les autres.</li> <li>la fonction calculerImpot permet de calculer l'imp\u00f4t une fois que toutes les donn\u00e9es ont \u00e9t\u00e9 obtenues quelque soit la fa\u00e7on dont elles ont \u00e9t\u00e9 obtenues.</li> <li>on notera donc qu'une \u00e9criture modulaire permet une (r\u00e9)utilisation de certains modules dans diff\u00e9rents contextes. Ce concept a \u00e9t\u00e9 dans les vingt derni\u00e8res ann\u00e9es fortement d\u00e9velopp\u00e9 dans le concept d'objet.</li> </ul>"}]}